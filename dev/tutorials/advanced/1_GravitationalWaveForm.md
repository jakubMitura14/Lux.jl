


<a id='Training-a-Neural-ODE-to-Model-Gravitational-Waveforms'></a>

# Training a Neural ODE to Model Gravitational Waveforms


This code is adapted from [Astroinformatics/ScientificMachineLearning](https://github.com/Astroinformatics/ScientificMachineLearning/blob/c93aac3a460d70b4cce98836b677fd9b732e94b7/neuralode_gw.ipynb)


The code has been minimally adapted from [Keith et. al. 2021](https://arxiv.org/abs/2102.12695) which originally used Flux.jl


<a id='Package-Imports'></a>

## Package Imports


```julia
using Lux, ComponentArrays, LineSearches, LuxAMDGPU, LuxCUDA, OrdinaryDiffEq,
    Optimization, OptimizationOptimJL, Random, SciMLSensitivity
using CairoMakie, MakiePublication
CUDA.allowscalar(false)
```


<a id='Define-some-Utility-Functions'></a>

## Define some Utility Functions


::: tip


This section can be skipped. It defines functions to simulate the model, however, from a scientific machine learning perspective, isn't super relevant.


:::


We need a very crude 2-body path. Assume the 1-body motion is a newtonian 2-body position vector $r = r_1 - r_2$ and use Newtonian formulas to get $r_1$, $r_2$ (e.g. Theoretical Mechanics of Particles and Continua 4.3)


```julia
function one2two(path, m₁, m₂)
    M = m₁ + m₂
    r₁ = m₂ / M .* path
    r₂ = -m₁ / M .* path
    return r₁, r₂
end
```


```
one2two (generic function with 1 method)
```


Next we define a function to perform the change of variables: $(\chi(t),\phi(t)) \mapsto (x(t),y(t))$


```julia
@views function soln2orbit(soln, model_params=nothing)
    @assert size(soln, 1) ∈ [2, 4] "size(soln,1) must be either 2 or 4"

    if size(soln, 1) == 2
        χ = soln[1, :]
        ϕ = soln[2, :]

        @assert length(model_params)==3 "model_params must have length 3 when size(soln,2) = 2"
        p, M, e = model_params
    else
        χ = soln[1, :]
        ϕ = soln[2, :]
        p = soln[3, :]
        e = soln[4, :]
    end

    r = p ./ (1 .+ e .* cos.(χ))
    x = r .* cos.(ϕ)
    y = r .* sin.(ϕ)

    orbit = vcat(x', y')
    return orbit
end
```


```
soln2orbit (generic function with 2 methods)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d_dt(v::AbstractVector, dt)
    a = -3 / 2 * v[1] + 2 * v[2] - 1 / 2 * v[3]
    b = (v[3:end] .- v[1:(end - 2)]) / 2
    c = 3 / 2 * v[end] - 2 * v[end - 1] + 1 / 2 * v[end - 2]
    return [a; b; c] / dt
end
```


```
d_dt (generic function with 1 method)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d2_dt2(v::AbstractVector, dt)
    a = 2 * v[1] - 5 * v[2] + 4 * v[3] - v[4]
    b = v[1:(end - 2)] .- 2 * v[2:(end - 1)] .+ v[3:end]
    c = 2 * v[end] - 5 * v[end - 1] + 4 * v[end - 2] - v[end - 3]
    return [a; b; c] / (dt^2)
end
```


```
d2_dt2 (generic function with 1 method)
```


Now we define a function to compute the trace-free moment tensor from the orbit


```julia
function orbit2tensor(orbit, component, mass=1)
    x = orbit[1, :]
    y = orbit[2, :]

    Ixx = x .^ 2
    Iyy = y .^ 2
    Ixy = x .* y
    trace = Ixx .+ Iyy

    if component[1] == 1 && component[2] == 1
        tmp = Ixx .- trace ./ 3
    elseif component[1] == 2 && component[2] == 2
        tmp = Iyy .- trace ./ 3
    else
        tmp = Ixy
    end

    return mass .* tmp
end

function h_22_quadrupole_components(dt, orbit, component, mass=1)
    mtensor = orbit2tensor(orbit, component, mass)
    mtensor_ddot = d2_dt2(mtensor, dt)
    return 2 * mtensor_ddot
end

function h_22_quadrupole(dt, orbit, mass=1)
    h11 = h_22_quadrupole_components(dt, orbit, (1, 1), mass)
    h22 = h_22_quadrupole_components(dt, orbit, (2, 2), mass)
    h12 = h_22_quadrupole_components(dt, orbit, (1, 2), mass)
    return h11, h12, h22
end

function h_22_strain_one_body(dt::T, orbit) where {T}
    h11, h12, h22 = h_22_quadrupole(dt, orbit)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)
    h11_1, h12_1, h22_1 = h_22_quadrupole(dt, orbit1, mass1)
    h11_2, h12_2, h22_2 = h_22_quadrupole(dt, orbit2, mass2)
    h11 = h11_1 + h11_2
    h12 = h12_1 + h12_2
    h22 = h22_1 + h22_2
    return h11, h12, h22
end

function h_22_strain_two_body(dt::T, orbit1, mass1, orbit2, mass2) where {T}
    # compute (2,2) mode strain from orbits of BH 1 of mass1 and BH2 of mass 2

    @assert abs(mass1 + mass2 - 1.0)<1e-12 "Masses do not sum to unity"

    h11, h12, h22 = h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function compute_waveform(dt::T, soln, mass_ratio, model_params=nothing) where {T}
    @assert mass_ratio≤1 "mass_ratio must be <= 1"
    @assert mass_ratio≥0 "mass_ratio must be non-negative"

    orbit = soln2orbit(soln, model_params)
    if mass_ratio > 0
        m₂ = inv(T(1) + mass_ratio)
        m₁ = mass_ratio * m₂

        orbit₁, orbit₂ = one2two(orbit, m₁, m₂)
        waveform = h_22_strain_two_body(dt, orbit1, mass1, orbit2, mass2)
    else
        waveform = h_22_strain_one_body(dt, orbit)
    end
    return waveform
end
```


```
compute_waveform (generic function with 2 methods)
```


<a id='Simulating-the-True-Model'></a>

## Simulating the True Model


`RelativisticOrbitModel` defines system of odes which describes motion of point like particle in schwarzschild background, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function RelativisticOrbitModel(u, (p, M, e), t)
    χ, ϕ = u

    numer = (p - 2 - 2 * e * cos(χ)) * (1 + e * cos(χ))^2
    denom = sqrt((p - 2)^2 - 4 * e^2)

    χ̇ = numer * sqrt(p - 6 - 2 * e * cos(χ)) / (M * (p^2) * denom)
    ϕ̇ = numer / (M * (p^(3 / 2)) * denom)

    return [χ̇, ϕ̇]
end

mass_ratio = 0.0         # test particle
u0 = Float64[π, 0.0]     # initial conditions
datasize = 250
tspan = (0.0f0, 6.0f4)   # timespace for GW waveform
tsteps = range(tspan[1], tspan[2]; length=datasize)  # time at each timestep
dt_data = tsteps[2] - tsteps[1]
dt = 100.0
const ode_model_params = [100.0, 1.0, 0.5]; # p, M, e
```


Let's simulate the true model and plot the results using `OrdinaryDiffEq.jl`


```julia
prob = ODEProblem(RelativisticOrbitModel, u0, tspan, ode_model_params)
soln = Array(solve(prob, RK4(); saveat=tsteps, dt, adaptive=false))
waveform = first(compute_waveform(dt_data, soln, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l, s]], ["Waveform Data"])

    return fig
end
```


![](1_GravitationalWaveForm-24.png)


<a id='Defiing-a-Neural-Network-Model'></a>

## Defiing a Neural Network Model


Next, we define the neural network model that takes 1 input (time) and has two outputs. We'll make a function `ODE_model` that takes the initial conditions, neural network parameters and a time as inputs and returns the derivatives.


It is typically never recommended to use globals but incase you do use them, make sure to mark them as `const`.


We will deviate from the standard Neural Network initialization and use `WeightInitializers.jl`,


```julia
const nn = Chain(Base.Fix1(broadcast, cos),
    Dense(1 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 2; init_weight=truncated_normal(; std=1e-4)))
ps, st = Lux.setup(MersenneTwister(), nn)
```


```
((layer_1 = NamedTuple(), layer_2 = (weight = Float32[0.00016324222; -9.119624f-5; -0.00013215918; 0.00017176564; -4.567573f-5; 2.1612163f-5; -6.5537515f-6; 0.00023585005; 2.8441096f-7; 1.0365963f-5; -0.00012393507; 0.00023947102; -0.00012061464; 4.6147205f-5; 4.7607128f-7; -0.00012716328; 0.00013870673; -9.800489f-6; 6.6325076f-5; -7.4665324f-5; 0.00018069167; -4.4364926f-5; 0.00010991306; -0.00021328381; -1.2823223f-5; -0.00014510199; -4.6632985f-7; 5.460931f-5; -8.374821f-6; -4.4428867f-5; 0.00011257101; -0.00010540306;;], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = Float32[2.0352512f-5 3.1095064f-5 -0.00014690851 -7.1498405f-5 -0.00018268912 -2.3935445f-6 8.746363f-5 -0.00015280856 -8.516575f-6 0.000115506155 7.361996f-6 -0.0001996118 -2.315496f-5 -4.914963f-5 -0.000109865076 1.7142731f-5 -1.250378f-5 8.783794f-5 2.2738623f-5 6.144092f-5 -0.00014374239 3.5928893f-5 0.000101807236 0.00010308867 -9.8049066f-5 -0.000118015 7.5107404f-5 5.924226f-5 9.359407f-5 6.0820254f-5 -1.44558035f-5 -5.2959243f-5; 0.00023917822 0.00014267137 8.94215f-6 -0.00025041527 5.9465452f-5 2.7345875f-5 0.00011233298 2.175004f-5 -6.223142f-5 -3.6721773f-5 0.000117990785 -0.00011356678 -1.7270982f-5 1.3274282f-5 1.821255f-5 -6.565896f-5 1.9350306f-5 -7.6640405f-5 3.5706664f-5 -0.00027730985 -2.5290596f-5 -5.661323f-6 0.00012272657 -0.00015412636 3.3480716f-5 7.245252f-5 -0.000105550134 7.2782525f-5 1.9953524f-5 -0.00012694673 -6.961555f-5 8.190299f-6; -5.4565055f-5 -0.00010275819 1.118798f-5 3.1535492f-5 0.00013471942 7.2929643f-6 2.8182296f-5 6.802318f-5 2.1317088f-5 -4.2006854f-5 -1.4425716f-6 6.4121894f-5 -9.2629925f-5 5.8966376f-5 3.3045308f-5 0.000103472885 -1.673433f-6 -0.00015603533 8.7537905f-5 -8.610445f-5 5.431371f-5 3.0447438f-5 5.292813f-5 -2.0208847f-5 -8.3438186f-5 -2.1028094f-5 -1.478353f-5 9.9974124f-5 6.8139336f-5 -1.50226515f-5 1.9281593f-5 5.3638403f-5; -5.195885f-5 3.9645634f-5 9.430083f-5 -7.718723f-5 4.2833602f-5 -6.996711f-5 2.997885f-5 1.9196028f-5 1.9925908f-5 5.242851f-5 -0.00010184467 4.7529356f-5 1.5024857f-5 6.540477f-5 -0.00020942633 -6.852442f-7 3.094688f-5 -0.00019075665 -1.1902138f-5 6.8307436f-6 0.0001455749 3.564065f-5 -0.00014437657 -0.00013580937 -8.677992f-6 0.0001825365 -4.7164784f-5 1.2907707f-5 -0.00010345788 -6.2221014f-5 5.627466f-5 0.00014317613; 0.0001525555 -1.853362f-5 -0.00014479333 2.7938619f-5 -8.786642f-5 -0.00011688139 0.00013733045 0.00024093936 2.9364426f-6 -6.9865804f-5 1.0805614f-5 8.411315f-5 -8.482784f-5 -0.00021885602 -7.7883466f-5 5.9892707f-5 -0.00010408596 2.9605408f-5 0.00013641999 0.00019910347 -5.6905716f-5 6.655267f-5 -6.960481f-5 0.00013548351 -0.0002575072 0.00014430154 -0.00015376059 -1.9419608f-6 -9.802321f-6 -9.4750845f-5 -9.149901f-5 -1.2095302f-5; -0.0001339324 -1.9366107f-7 2.6418307f-5 -3.9693867f-5 -7.23049f-5 -2.5559164f-5 -5.4379863f-5 2.1526464f-5 2.6460608f-5 1.9293484f-6 0.00022817905 -0.0001521725 5.8283662f-5 0.0001868265 -3.4142166f-5 0.0001340137 -2.0039886f-5 -3.0700245f-5 -9.7599775f-5 -4.939068f-5 7.579672f-5 -0.00021070022 0.00020208767 2.0089707f-5 0.0001477048 -0.0001539767 0.00012176683 8.4471816f-5 -2.771942f-5 -0.00015391971 7.742545f-5 2.4331403f-5; 0.00010020603 4.7399993f-5 0.0001277548 -6.6377885f-5 5.4431872f-5 4.7906527f-5 -0.00018613532 3.9053142f-5 -1.6775808f-5 8.714898f-5 -9.830185f-6 -3.5854926f-5 -1.6167443f-5 7.2010116f-5 -0.00013441799 -0.00031335012 -1.645854f-5 -0.00013444986 -7.7668396f-5 4.372973f-5 0.00010826108 -9.397077f-5 -0.00012386682 1.785429f-5 5.221833f-5 -3.3709584f-5 -3.1177242f-5 5.6116143f-5 0.00020381002 1.775353f-5 2.2081115f-6 -3.868237f-6; 0.0003185736 0.00014498556 -3.2769614f-5 0.00012887761 7.4201795f-5 -8.3855324f-5 -5.937429f-5 9.414856f-5 0.00010427439 0.00010234722 -2.0513004f-5 1.1394006f-5 2.156662f-5 1.8260947f-5 -7.2765456f-6 -2.2839097f-6 4.1193765f-5 -5.231544f-5 0.00011419141 -0.000102283426 -4.2299336f-5 -5.7397465f-5 0.0001214215 3.0544372f-6 -5.365407f-5 3.0331621f-5 -5.9595336f-6 -0.000119744116 6.494811f-5 -3.891599f-5 -7.906934f-5 -2.6112873f-5; -0.000117204145 -0.00026418007 -0.00018974824 -0.00016577769 -4.273286f-6 -0.00010214442 -9.301029f-5 4.106935f-5 3.977681f-5 5.463675f-5 5.108262f-5 0.00013421928 -5.2211344f-5 4.0032985f-5 -4.128372f-5 0.00016483653 1.5472062f-5 0.0002036004 -5.0666073f-5 -0.00014083053 -2.5309353f-5 -8.473449f-5 -0.00023899699 -0.00014496608 9.618354f-5 6.9613366f-6 -1.0948814f-5 -3.9807244f-5 7.811089f-6 2.0696098f-6 6.784889f-6 -6.4786735f-5; -7.327928f-5 -2.6168962f-5 -7.4985f-5 -9.283879f-5 -4.3783624f-5 -0.00013029289 -0.00023082648 -3.1957665f-5 -8.837264f-5 -3.549718f-5 -2.3566508f-5 2.0371395f-5 0.00011816088 7.712224f-5 -5.389496f-6 -7.146067f-5 -5.832921f-5 -0.00010129306 -6.7403926f-5 -5.2101277f-5 -0.000101119316 5.591165f-5 -9.161056f-5 -0.0001329105 -9.316251f-5 0.000113185546 0.00022050197 -3.1915875f-5 -3.8756716f-5 -5.736875f-5 0.00017918734 4.2504057f-6; 2.9614492f-5 1.0533825f-5 -7.841571f-6 1.941994f-5 -4.3902346f-5 2.6666363f-5 -8.385437f-6 1.1330007f-5 0.00012876341 -3.6546815f-5 -7.3623555f-6 5.03504f-5 -4.4501205f-5 -3.0306184f-5 5.863537f-6 0.00016774838 -2.0875188f-5 -0.00015588288 -7.8319084f-5 -5.964956f-5 0.00011243839 7.0915645f-5 -3.1659187f-5 -1.2173477f-5 -0.000105187704 0.00011552082 5.9642034f-6 -0.00016252008 6.635189f-5 1.1558477f-5 9.641115f-5 -8.96315f-5; -8.1740756f-5 -0.00020712308 -8.3752f-5 0.00010507029 5.1923493f-5 -3.789872f-5 8.611501f-5 -0.00017084068 -8.519217f-5 -0.00014451735 7.9978105f-5 -3.873974f-5 0.00010452798 -0.00010135421 9.411166f-5 0.00012958903 4.4220622f-5 7.588429f-5 5.711548f-5 1.7450719f-5 -5.1037325f-8 0.00012886741 5.578302f-5 2.9469753f-5 -1.2666604f-5 -5.5075914f-5 -0.00012878102 3.325597f-5 2.974096f-5 9.220161f-5 -7.300682f-5 9.47867f-6; 0.00019889289 -0.0001338034 0.00014300561 -0.00014150333 -3.419472f-5 -6.771973f-5 -4.9783055f-5 8.206299f-5 5.9291873f-5 9.268767f-5 3.954361f-6 -0.00014559922 -2.6984704f-5 -0.00012783735 0.00012094556 -2.1783942f-5 6.517258f-5 -9.854748f-5 -5.1956253f-5 -0.000107268075 -7.178847f-5 -0.00018488377 6.8878406f-5 7.0399976f-5 -0.00015944403 6.5166256f-5 -3.5785182f-5 -1.8703668f-5 2.1700354f-5 -0.00013651379 -0.000109741835 8.55834f-5; 0.00023588576 -6.622726f-5 1.4675418f-5 0.00019011876 6.131974f-5 1.5262494f-5 5.636003f-5 -6.675969f-5 -2.5149533f-5 -5.3667492f-5 -4.623381f-5 -5.8396804f-6 0.00015805227 0.00014200204 -5.1836047f-5 2.8779143f-5 -5.3420634f-5 -5.7976263f-6 0.00013828298 -1.6622485f-5 1.3216524f-5 -0.00017151731 7.0596056f-5 -3.5001598f-5 -7.1746756f-5 3.6702688f-5 1.0717764f-5 5.1137682f-5 -0.00017994769 -0.000100988866 -5.152275f-5 -4.4208296f-6; 6.947596f-5 9.348623f-5 -8.496182f-5 0.00010041473 0.00019154833 -0.00014016859 7.116393f-5 0.00010619239 -8.289127f-5 1.4602034f-6 5.05745f-6 -0.00016898217 -0.00014861328 4.8111135f-5 -5.1740746f-5 -7.587243f-7 -0.00014827408 -2.5760171f-5 6.8726506f-5 -2.0112453f-5 2.2994373f-5 8.618902f-5 -0.00012240082 0.00013172677 2.8643657f-5 0.0001011558 1.0458649f-5 -9.975062f-5 9.86991f-6 -1.9234138f-5 -0.00015728352 -0.00022432988; -1.3581349f-5 -7.585357f-5 4.988672f-5 -5.1777235f-5 -0.00011125382 -1.1545121f-5 3.6764716f-6 1.020149f-7 -0.00012976532 -9.1197646f-5 2.1450169f-5 -8.3646126f-5 -1.1652006f-5 4.406712f-6 -6.38991f-5 -9.2028895f-6 -2.5937827f-5 6.5087355f-5 0.00016330296 2.9099272f-5 -0.00017476319 -5.736826f-5 -9.377041f-6 -7.750624f-5 0.00017532626 -9.170234f-5 0.00016063188 -1.2013793f-5 4.3875093f-6 5.671631f-5 8.348216f-5 8.118092f-5; -2.7536013f-5 6.4000276f-5 3.2190805f-5 0.00019838041 4.8499172f-5 -2.1427726f-5 -2.3545372f-5 -2.2269436f-5 -0.00013594996 -3.6855643f-5 6.515994f-5 6.4896394f-6 1.5264248f-5 6.1005692f-5 -0.00013642598 -3.832923f-5 -0.00015849079 0.00016261317 -6.1499144f-5 3.5110108f-5 -4.067346f-5 -0.00017284858 -5.8239155f-5 -8.216693f-5 -9.973907f-5 -0.00013459267 -9.918353f-5 3.0545568f-6 -4.0908668f-5 -3.5834753f-5 5.7290566f-5 3.714187f-5; 6.387689f-5 -0.00015594928 5.6415905f-5 -0.00015538241 0.00013563577 0.00015580478 7.5329095f-5 5.384002f-5 0.000101392776 -5.7883288f-5 -6.105605f-5 -4.3238915f-6 0.00012506207 -4.7592126f-5 -4.7842823f-5 -9.069531f-5 -4.4735338f-5 0.000113502734 -3.465853f-6 0.0002026299 3.6999343f-5 -3.072192f-5 -7.733821f-5 -0.00014215708 5.8979316f-5 -4.6347996f-5 8.65445f-5 0.00022016684 -9.593143f-5 -8.0435464f-5 -4.3493446f-6 0.00010878796; -3.396177f-5 4.2554362f-5 -3.075002f-5 6.066085f-5 8.444185f-5 4.9939517f-5 0.00012160662 -0.000111406254 7.343563f-5 8.209136f-5 -8.463181f-5 0.00018464364 6.5304586f-5 -4.3682783f-5 0.00011692282 -2.9004268f-5 0.00014443361 0.00011455071 0.00018252307 -4.074475f-5 -9.303181f-6 0.00013156755 3.3497847f-5 7.1417824f-5 0.00018720122 -0.00011327972 -0.00011806142 -3.7639173f-5 0.000111020425 -1.8897192f-5 -9.1083166f-5 5.9481248f-5; -2.0863186f-5 3.919301f-5 0.00025514013 -0.00021395716 -2.3026203f-6 -5.3359403f-5 0.00028699162 -1.8474497f-5 3.8750695f-5 -1.4892324f-5 1.51657605f-5 -3.0925192f-5 -6.5319124f-5 4.547715f-5 0.00012131845 6.530314f-7 0.00019466528 -4.4556473f-5 0.00011242243 -9.6491225f-5 4.3803393f-5 4.8498487f-6 -5.15048f-5 -5.3520092f-5 4.742116f-5 -1.5084576f-5 -5.6963104f-6 8.164672f-5 2.0683865f-5 -6.8739755f-5 -2.2928627f-5 3.265093f-5; -5.0621096f-5 -6.590137f-5 2.7295255f-5 6.785588f-5 -2.8580496f-5 -9.9356424f-5 1.1650773f-5 7.711556f-5 -9.58411f-5 0.00012281221 0.000113843395 0.000106759195 0.00012596944 -5.3573513f-5 -5.0661656f-5 2.9598383f-5 9.529484f-5 -0.0001577809 -5.3622807f-5 -9.790777f-5 8.706811f-5 -3.5291956f-5 -7.171275f-5 -8.7624816f-5 -0.00011768708 -7.681042f-5 -9.935708f-7 2.4225597f-5 0.00010456545 5.037927f-5 -0.00013142326 -9.4944684f-5; 0.00014995597 9.9867204f-5 0.00010407928 -1.625797f-5 -8.0463964f-5 0.00012900421 -6.693712f-5 -4.135112f-5 0.00011543835 -0.00015414234 -5.28896f-5 -0.00014405786 0.00011248299 0.00018868306 7.552095f-5 0.00014891988 3.222612f-5 7.768169f-5 6.1481995f-5 9.831897f-5 8.42319f-6 1.0490678f-5 0.00016387862 4.3720458f-5 0.00011128251 -2.4865307f-5 2.9269771f-5 0.0001534394 -2.2581313f-5 1.3514247f-6 -9.0199155f-6 5.7974503f-5; 0.00012908941 0.00017004985 -0.00018264982 6.916146f-5 -0.00011736274 3.640524f-5 3.5545112f-5 -4.313633f-6 -0.00014152595 0.00015956355 -9.808469f-5 -1.6323043f-5 0.00015479345 0.00010319818 0.00011270321 8.3133426f-5 2.4202704f-5 -3.1022998f-6 -3.1354843f-6 2.4498442f-5 3.8871032f-5 0.00011755304 -3.2524476f-5 5.8996102f-5 -0.00012047246 6.8739337f-6 4.8895792f-5 0.00017723218 9.092457f-5 -0.0002519251 -0.00020486841 0.00010372596; -1.4538302f-5 8.6650325f-5 -3.7312595f-5 4.6926398f-5 -3.453653f-5 6.4605716f-5 -7.2248404f-5 3.69334f-5 8.0661266f-5 -0.00010153277 4.0734587f-5 0.000107013606 1.6191611f-6 -0.00013487975 -5.5884993f-5 2.0279393f-5 2.8286406f-5 0.00012634843 1.1813186f-5 5.666585f-5 -0.00012374368 -4.7270576f-5 5.680179f-5 -0.00022150482 -1.6856606f-5 -0.0001095007 -0.00011607836 4.440443f-5 1.3667938f-5 7.2006165f-5 -2.2913011f-5 -0.00013765764; 8.1997605f-5 -6.452525f-5 8.806071f-5 -2.1008482f-5 3.210997f-5 6.655964f-5 6.713056f-5 -0.00016632843 -0.00010709088 -0.00023671682 0.0001224285 0.00010259175 -1.7455664f-5 0.0001957273 -4.8776277f-5 -5.619948f-5 8.792996f-7 0.00022593803 -0.00015920513 0.000113371156 0.00013078543 -0.00011460031 7.1746064f-5 3.7807007f-5 4.3961943f-5 -3.7801263f-5 3.4184613f-5 8.801515f-5 0.00016829275 0.00012259601 1.7522567f-5 -4.758088f-5; -7.61407f-5 0.00023261113 0.00010287864 -5.2581512f-5 -8.438424f-5 -5.220388f-5 3.290803f-5 -5.70884f-5 -0.00014070483 8.846607f-5 1.3876808f-5 4.8209688f-5 -3.4639597f-5 5.00585f-5 -8.6742046f-5 -9.211471f-5 0.00017770176 0.00017859438 -6.6805464f-6 -3.1701824f-5 -0.0001080853 -0.00016671348 -5.1568786f-5 3.394132f-5 -4.6823243f-5 -0.00010998826 9.351436f-5 1.1708537f-5 -3.887448f-5 -7.375329f-6 4.9114395f-5 0.00010338264; 4.012148f-5 0.00015258277 6.675099f-5 -3.5857985f-5 -0.0001611402 -7.629752f-5 2.518402f-7 0.000107760796 3.575871f-5 7.0248796f-5 -0.0002119451 0.00015965145 6.493335f-5 0.00019593019 3.8042337f-5 3.5766356f-5 0.0001981641 -0.00017709668 -0.00016501152 -4.7592894f-5 7.5985394f-5 -5.019589f-5 -8.576433f-5 -4.8806905f-5 -0.000118296186 0.00013327065 -5.3301013f-5 -5.5408425f-5 -0.00013813947 -3.0759606f-5 4.0480543f-5 0.000112697286; 0.00010101345 -0.00016902118 -9.565131f-5 -8.2149345f-5 -3.7574933f-5 1.1007224f-5 0.0001277275 -9.624706f-5 5.2399268f-5 0.00021041968 -8.782335f-5 -3.621026f-5 0.0001323685 2.1432312f-5 2.5981835f-5 8.643748f-5 6.997669f-7 -3.8836974f-6 6.6953275f-5 2.1354383f-5 -7.462201f-5 1.0461863f-5 0.00013906661 -0.000106995496 0.00017077039 0.000109062195 -0.00023139206 -2.105733f-5 3.2964374f-5 4.412769f-5 3.6590776f-5 7.63485f-5; 5.106267f-5 7.4600815f-5 -4.112765f-5 -0.00022245018 -3.1189287f-5 5.026179f-5 -7.998226f-5 4.4217428f-5 5.5362652f-5 1.01656326f-7 0.0002893583 4.1623607f-5 0.00011844484 1.1187806f-6 0.00015622124 0.00016961634 7.3096826f-6 -7.2098395f-5 9.984792f-5 9.2643924f-5 0.00014144741 6.8831745f-5 -0.0001337301 7.690814f-6 -0.00010866168 -2.9126986f-5 -7.8084675f-5 -0.000105274514 8.60967f-5 -0.000116463954 4.8826565f-5 4.8688456f-5; 4.6940007f-5 -0.00010401633 6.231184f-5 -4.5720326f-6 7.6332617f-7 1.867551f-5 9.310727f-5 -2.7594242f-5 -0.00010123413 6.431624f-5 7.8951794f-5 2.71248f-5 -4.9939685f-5 -0.00012237231 -0.00034171678 -0.00012881895 4.313712f-5 0.00011240264 4.9043076f-5 6.835855f-5 -5.0007802f-5 7.324403f-5 0.00013663566 0.00011626665 8.2151266f-5 -1.1502858f-5 2.6178765f-5 -9.5980584f-5 8.190869f-6 -2.3607894f-5 -9.036304f-5 -6.0809503f-5; -1.3715958f-5 -8.4105144f-5 5.94652f-5 -1.9556102f-5 2.1925116f-5 -3.5643992f-5 -5.8246696f-5 -5.694152f-5 -0.000102209335 8.679522f-6 7.6391734f-5 -1.5113198f-5 -6.6240325f-5 -0.000184844 -9.4550596f-5 0.00011712846 -2.0785837f-5 -6.758379f-5 0.000108300985 6.7595515f-6 -7.255279f-5 -9.810127f-6 -1.59614f-5 4.956873f-5 8.167483f-6 -8.194889f-5 0.00013709643 2.5927042f-5 9.240475f-5 -3.420102f-5 5.480751f-5 4.9685972f-5; -0.00020982676 3.7551366f-5 -0.000317688 2.4183997f-5 0.00011306101 -6.0924223f-5 6.457807f-5 -1.4142357f-5 -0.000128107 -6.5874106f-6 9.308658f-5 1.4210631f-5 -2.3523437f-5 7.286542f-5 3.9716757f-5 6.2665895f-5 6.396984f-5 -9.176765f-5 -3.8753045f-5 -2.7184919f-5 3.5043948f-5 2.858697f-5 0.00011622824 9.2644936f-5 5.1493167f-5 -8.104585f-6 7.390525f-5 4.8003272f-5 -4.0212988f-5 -1.2165291f-6 -9.684714f-5 9.223183f-5], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = Float32[-0.00018670957 -9.541074f-6 -0.00013809797 -0.00011070807 2.1012178f-5 5.4213586f-5 0.00010108545 -1.2317656f-5 -4.4426197f-5 -3.9467428f-5 -0.00015926575 0.00013600901 3.4293927f-5 -0.00012730816 -0.0001241107 -9.681236f-6 3.5843008f-5 1.7332102f-5 -5.9415746f-5 -8.2969396f-5 0.000117571646 0.0002759793 9.958855f-6 4.8106886f-6 4.2525542f-5 -0.00019993688 -2.6721078f-5 -1.02872555f-5 8.210894f-5 -1.2647777f-5 4.3727825f-5 0.00021627768; -0.00019834792 0.00013227729 0.000100626545 0.00010731468 -0.00012726826 5.814706f-5 -0.00012364305 -0.00012802178 0.000105111096 5.542588f-5 -0.00020780713 0.00015936312 -1.111684f-5 -8.543636f-5 4.7421592f-5 -1.0107236f-6 0.00010073915 -0.00020665898 0.00013010262 0.00013388699 3.9867737f-5 -6.263764f-5 7.322219f-5 3.5386773f-5 -0.00021300833 -3.9218987f-5 -0.000105643434 -1.9719871f-5 6.9237656f-5 -7.6174845f-5 3.7278416f-5 -0.00014633528], bias = Float32[0.0; 0.0;;])), (layer_1 = NamedTuple(), layer_2 = NamedTuple(), layer_3 = NamedTuple(), layer_4 = NamedTuple()))
```


Similar to most DL frameworks, Lux defaults to using `Float32`, however, in this case we need Float64


```julia
const params = ComponentArray{Float64}(ps)
```


```
ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [0.00016324222087860107; -9.119624155573547e-5; -0.0001321591844316572; 0.00017176564142573625; -4.567572977975942e-5; 2.161216252716258e-5; -6.55375151836779e-6; 0.00023585004964843392; 2.8441095878406486e-7; 1.0365963134972844e-5; -0.00012393506767693907; 0.00023947101726662368; -0.00012061464076396078; 4.6147204557200894e-5; 4.760712783991039e-7; -0.0001271632791031152; 0.0001387067313771695; -9.800489351619035e-6; 6.632507574977353e-5; -7.466532406397164e-5; 0.00018069166981149465; -4.43649259977974e-5; 0.0001099130604416132; -0.0002132838126271963; -1.2823223187297117e-5; -0.00014510199252981693; -4.6632985117867065e-7; 5.4609310609521344e-5; -8.374820936296601e-6; -4.4428867113310844e-5; 0.00011257101141382009; -0.0001054030581144616;;], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = [2.0352512365207076e-5 3.1095063604880124e-5 -0.00014690851094201207 -7.149840530473739e-5 -0.0001826891239034012 -2.3935444914968684e-6 8.746363164391369e-5 -0.00015280855586752295 -8.51657478051493e-6 0.00011550615454325452 7.361995812971145e-6 -0.0001996117935050279 -2.3154960217652842e-5 -4.9149628466693684e-5 -0.00010986507550114766 1.7142730939667672e-5 -1.250378045369871e-5 8.783794328337535e-5 2.2738622647011653e-5 6.144092185422778e-5 -0.00014374239253811538 3.5928893339587376e-5 0.00010180723620578647 0.00010308867058483884 -9.804906585486606e-5 -0.00011801499931607395 7.510740397265181e-5 5.9242258430458605e-5 9.359406976727769e-5 6.082025356590748e-5 -1.4455803466262296e-5 -5.295924347592518e-5; 0.0002391782181803137 0.00014267137157730758 8.942150088842027e-6 -0.0002504152653273195 5.946545206825249e-5 2.7345875423634425e-5 0.00011233297846047208 2.1750040104961954e-5 -6.223141826922074e-5 -3.672177263069898e-5 0.00011799078492913395 -0.00011356677714502439 -1.727098242554348e-5 1.327428162767319e-5 1.821254954847973e-5 -6.565896183019504e-5 1.935030559252482e-5 -7.664040458621457e-5 3.570666376617737e-5 -0.000277309853117913 -2.5290595658589154e-5 -5.6613230299262796e-6 0.0001227265747729689 -0.00015412636275868863 3.348071550135501e-5 7.24525234545581e-5 -0.0001055501343216747 7.27825245121494e-5 1.9953524315496907e-5 -0.00012694673205260187 -6.961554754525423e-5 8.190299013222102e-6; -5.4565054597333074e-5 -0.00010275818931404501 1.1187979907845147e-5 3.1535491871181875e-5 0.0001347194192931056 7.292964255611878e-6 2.8182295864098705e-5 6.802318239351735e-5 2.1317087885108776e-5 -4.200685361865908e-5 -1.4425716017285595e-6 6.412189395632595e-5 -9.262992534786463e-5 5.896637594560161e-5 3.304530764580704e-5 0.00010347288480261341 -1.6734329619794153e-6 -0.00015603532665409148 8.753790461923927e-5 -8.610444638179615e-5 5.4313710279529914e-5 3.0447437893599272e-5 5.292813148116693e-5 -2.020884676312562e-5 -8.343818626599386e-5 -2.1028094124631025e-5 -1.4783529877604451e-5 9.997412416851148e-5 6.813933578087017e-5 -1.5022651496110484e-5 1.9281593267805874e-5 5.36384031875059e-5; -5.1958850235678256e-5 3.9645634387852624e-5 9.430082718608901e-5 -7.718722918070853e-5 4.2833602492464706e-5 -6.996710726525635e-5 2.9978849852341227e-5 1.9196028006263077e-5 1.9925908418372273e-5 5.242850966169499e-5 -0.00010184467100771144 4.75293563795276e-5 1.5024857020762283e-5 6.540476897498593e-5 -0.0002094263327307999 -6.852441742921656e-7 3.0946881452109665e-5 -0.00019075664749834687 -1.1902137885044795e-5 6.830743586760946e-6 0.0001455749006709084 3.5640649002743885e-5 -0.0001443765650037676 -0.0001358093722956255 -8.677991900185589e-6 0.00018253650341648608 -4.716478360933252e-5 1.2907707059639506e-5 -0.00010345788177801296 -6.222101364983246e-5 5.6274660892086104e-5 0.00014317613386083394; 0.00015255549806170166 -1.8533619368099608e-5 -0.00014479333185590804 2.7938618586631492e-5 -8.786642138147727e-5 -0.00011688139056786895 0.00013733045489061624 0.0002409393637208268 2.9364425699895946e-6 -6.986580410739407e-5 1.080561378330458e-5 8.41131477500312e-5 -8.48278432385996e-5 -0.00021885601745452732 -7.788346556480974e-5 5.989270721329376e-5 -0.0001040859569911845 2.9605407689814456e-5 0.000136419985210523 0.00019910346600227058 -5.690571560990065e-5 6.655266770394519e-5 -6.96048082318157e-5 0.0001354835112579167 -0.000257507199421525 0.00014430153532885015 -0.0001537605858175084 -1.9419608179305214e-6 -9.802321073948406e-6 -9.475084516452625e-5 -9.149900870397687e-5 -1.209530182677554e-5; -0.0001339323935098946 -1.9366106585039233e-7 2.6418307243147865e-5 -3.9693866710877046e-5 -7.230490155052394e-5 -2.555916398705449e-5 -5.437986328615807e-5 2.1526464479393326e-5 2.6460607841727324e-5 1.9293484001536854e-6 0.00022817905119154602 -0.00015217250620480627 5.828366192872636e-5 0.0001868264953373 -3.414216553210281e-5 0.0001340136950602755 -2.0039886294398457e-5 -3.070024467888288e-5 -9.759977547219023e-5 -4.939068094245158e-5 7.579672092106193e-5 -0.00021070022194180638 0.00020208767091389745 2.0089706595172174e-5 0.00014770480629522353 -0.00015397669631056488 0.00012176683230791241 8.447181608062238e-5 -2.7719419449567795e-5 -0.0001539197110105306 7.742545130895451e-5 2.4331402528332546e-5; 0.00010020603076554835 4.7399993491126224e-5 0.00012775479990523309 -6.637788465013728e-5 5.443187183118425e-5 4.790652747033164e-5 -0.00018613532301969826 3.9053142245393246e-5 -1.677580803516321e-5 8.714898285688832e-5 -9.830185263126623e-6 -3.585492595448159e-5 -1.616744339116849e-5 7.20101161277853e-5 -0.0001344179909210652 -0.0003133501159027219 -1.645853990339674e-5 -0.00013444985961541533 -7.766839553369209e-5 4.372973126010038e-5 0.00010826108336914331 -9.39707679208368e-5 -0.00012386681919451803 1.7854290490504354e-5 5.221832907409407e-5 -3.3709584386087954e-5 -3.117724190815352e-5 5.6116143241524696e-5 0.00020381002104841173 1.7753529391484335e-5 2.2081114821048686e-6 -3.868236944981618e-6; 0.00031857361318543553 0.00014498556265607476 -3.276961433584802e-5 0.00012887761113233864 7.420179463224486e-5 -8.385532419197261e-5 -5.9374291595304385e-5 9.414856322109699e-5 0.00010427438974147663 0.00010234722140012309 -2.051300361927133e-5 1.1394005923648365e-5 2.1566620489466004e-5 1.8260947399539873e-5 -7.276545602508122e-6 -2.2839096800453262e-6 4.119376535527408e-5 -5.231544128037058e-5 0.00011419141083024442 -0.00010228342580376193 -4.229933620081283e-5 -5.739746484323405e-5 0.00012142150080762804 3.054437229366158e-6 -5.365406832424924e-5 3.0331621019286104e-5 -5.959533609711798e-6 -0.00011974411609116942 6.494810804724693e-5 -3.891599044436589e-5 -7.906933751655743e-5 -2.6112873456440866e-5; -0.00011720414477167651 -0.000264180067460984 -0.00018974824342876673 -0.0001657776883803308 -4.273285867384402e-6 -0.00010214441863354295 -9.30102905840613e-5 4.106935011805035e-5 3.977680898969993e-5 5.463674824568443e-5 5.1082621212117374e-5 0.00013421928451862186 -5.2211344154784456e-5 4.003298454335891e-5 -4.128372165723704e-5 0.00016483652871102095 1.5472061932086945e-5 0.0002036004007095471 -5.066607263870537e-5 -0.00014083052519708872 -2.530935307731852e-5 -8.473449270240963e-5 -0.00023899698862805963 -0.00014496607764158398 9.618353942641988e-5 6.961336566746468e-6 -1.0948813724098727e-5 -3.980724432040006e-5 7.811088835296687e-6 2.0696097635664046e-6 6.784889137634309e-6 -6.478673458332196e-5; -7.327928324230015e-5 -2.6168961994699202e-5 -7.49850005377084e-5 -9.283878898713738e-5 -4.3783624278148636e-5 -0.00013029288675170392 -0.0002308264811290428 -3.195766475982964e-5 -8.837263885652646e-5 -3.5497181670507416e-5 -2.3566508389194496e-5 2.0371395294205286e-5 0.00011816088226623833 7.712224032729864e-5 -5.389495981944492e-6 -7.146067218855023e-5 -5.832920942339115e-5 -0.00010129305883310735 -6.74039256409742e-5 -5.2101277105975896e-5 -0.00010111931624123827 5.5911648814799264e-5 -9.161055641015992e-5 -0.00013291049981489778 -9.316251089330763e-5 0.00011318554606987163 0.00022050197003409266 -3.191587529727258e-5 -3.8756716094212607e-5 -5.736875027650967e-5 0.00017918733647093177 4.2504057091719005e-6; 2.9614491722895764e-5 1.0533824934100267e-5 -7.841570550226606e-6 1.941994014487136e-5 -4.390234607853927e-5 2.6666362828109413e-5 -8.385436558455694e-6 1.1330006600474007e-5 0.00012876340770162642 -3.6546814953908324e-5 -7.362355518125696e-6 5.035040157963522e-5 -4.4501204683911055e-5 -3.0306184271466918e-5 5.863536898687016e-6 0.00016774838150013238 -2.0875188056379557e-5 -0.0001558828807901591 -7.831908442312852e-5 -5.964955926174298e-5 0.00011243839253438637 7.091564475558698e-5 -3.16591867886018e-5 -1.2173477443866432e-5 -0.000105187704320997 0.00011552082287380472 5.964203410258051e-6 -0.00016252008208539337 6.63518876535818e-5 1.1558477126527578e-5 9.641115320846438e-5 -8.963150321505964e-5; -8.174075628630817e-5 -0.00020712308469228446 -8.37519983178936e-5 0.00010507029219297692 5.192349271965213e-5 -3.789872062043287e-5 8.611501107225195e-5 -0.00017084067803807557 -8.51921722642146e-5 -0.00014451735478360206 7.997810462256894e-5 -3.873974128509872e-5 0.00010452797869220376 -0.00010135421325685456 9.411165956407785e-5 0.00012958902516402304 4.42206219304353e-5 7.588428707094863e-5 5.711548146791756e-5 1.745071858749725e-5 -5.103732547695472e-8 0.00012886741023976356 5.578302079811692e-5 2.9469752917066216e-5 -1.266660365217831e-5 -5.507591413334012e-5 -0.00012878101551905274 3.3255968446610495e-5 2.9740960599156097e-5 9.220161155099049e-5 -7.300682045752183e-5 9.478670108364895e-6; 0.00019889288523700088 -0.00013380340533331037 0.00014300561451818794 -0.00014150333299767226 -3.4194719773950055e-5 -6.771973130526021e-5 -4.978305514669046e-5 8.206298662116751e-5 5.929187318542972e-5 9.268766734749079e-5 3.954361091018654e-6 -0.000145599216921255 -2.6984704163623974e-5 -0.0001278373529203236 0.00012094555859221146 -2.1783942429465242e-5 6.51725786156021e-5 -9.854748350335285e-5 -5.195625271880999e-5 -0.00010726807522587478 -7.178846863098443e-5 -0.00018488377099856734 6.887840572744608e-5 7.039997581159696e-5 -0.00015944402548484504 6.516625580843538e-5 -3.578518226277083e-5 -1.8703667592490092e-5 2.17003544094041e-5 -0.00013651378685608506 -0.00010974183533107862 8.558340050512925e-5; 0.00023588576004840434 -6.622725777560845e-5 1.4675418242404703e-5 0.0001901187642943114 6.131974078016356e-5 1.5262494343915023e-5 5.636002970277332e-5 -6.675969052594155e-5 -2.5149533030344173e-5 -5.3667492466047406e-5 -4.623381028068252e-5 -5.8396803979121614e-6 0.0001580522657604888 0.00014200204168446362 -5.183604662306607e-5 2.8779142667190172e-5 -5.342063377611339e-5 -5.797626272396883e-6 0.00013828297960571945 -1.662248541833833e-5 1.32165241666371e-5 -0.00017151731299236417 7.059605559334159e-5 -3.500159800751135e-5 -7.174675556598231e-5 3.6702687793876976e-5 1.0717763871070929e-5 5.113768202136271e-5 -0.00017994768859352916 -0.00010098886559717357 -5.1522751164156944e-5 -4.420829554874217e-6; 6.947595829842612e-5 9.348623279947788e-5 -8.496182272210717e-5 0.00010041472705779597 0.00019154832989443094 -0.00014016858767718077 7.116392953321338e-5 0.00010619239037623629 -8.289126708405092e-5 1.4602034070776426e-6 5.057449925516266e-6 -0.00016898216563276947 -0.00014861328236293048 4.811113467440009e-5 -5.174074613023549e-5 -7.587242976114794e-7 -0.00014827407721895725 -2.5760171411093324e-5 6.872650556033477e-5 -2.0112453057663515e-5 2.29943725571502e-5 8.618902211310342e-5 -0.00012240081559866667 0.00013172677427064627 2.8643657060456462e-5 0.00010115579789271578 1.0458648830535822e-5 -9.9750621302519e-5 9.86991017271066e-6 -1.9234137653256766e-5 -0.00015728351718280464 -0.00022432988043874502; -1.3581348866864573e-5 -7.585356797790155e-5 4.9886719352798536e-5 -5.177723505767062e-5 -0.00011125382297905162 -1.1545121196832042e-5 3.676471578728524e-6 1.0201490141525937e-7 -0.0001297653216170147 -9.1197645815555e-5 2.1450168787851e-5 -8.364612585864961e-5 -1.1652005923679098e-5 4.406711923365947e-6 -6.389909685822204e-5 -9.2028894869145e-6 -2.5937826649169438e-5 6.508735532406718e-5 0.00016330296057276428 2.9099272069288418e-5 -0.00017476319044362754 -5.7368259149370715e-5 -9.377041351399384e-6 -7.75062435423024e-5 0.00017532626225147396 -9.170234261546284e-5 0.0001606318837730214 -1.201379291160265e-5 4.387509306980064e-6 5.671631151926704e-5 8.348216215381399e-5 8.118092227960005e-5; -2.753601256699767e-5 6.400027632480487e-5 3.219080463168211e-5 0.0001983804104384035 4.8499172407900915e-5 -2.142772609659005e-5 -2.3545371732325293e-5 -2.226943615823984e-5 -0.00013594995834864676 -3.685564297484234e-5 6.515994027722627e-5 6.4896394178504124e-6 1.526424784970004e-5 6.1005692259641364e-5 -0.0001364259805995971 -3.832923175650649e-5 -0.00015849078772589564 0.00016261317068710923 -6.149914406705648e-5 3.511010800139047e-5 -4.0673461626283824e-5 -0.00017284858040511608 -5.82391548960004e-5 -8.216693095164374e-5 -9.973906708182767e-5 -0.00013459267211146653 -9.918353316606954e-5 3.0545568279194413e-6 -4.0908667870098725e-5 -3.583475336199626e-5 5.7290566473966464e-5 3.7141868233447894e-5; 6.387689063558355e-5 -0.00015594928117934614 5.641590541927144e-5 -0.0001553824113216251 0.0001356357679469511 0.00015580478066112846 7.532909512519836e-5 5.3840019972994924e-5 0.00010139277583220974 -5.788328780909069e-5 -6.105605280026793e-5 -4.3238915168331005e-6 0.0001250620698556304 -4.759212606586516e-5 -4.7842822823440656e-5 -9.069530642591417e-5 -4.4735337723977864e-5 0.00011350273416610435 -3.4658530694287037e-6 0.00020262990437913686 3.699934313772246e-5 -3.0721919756615534e-5 -7.733821257716045e-5 -0.00014215707778930664 5.897931623621844e-5 -4.634799552150071e-5 8.654450357425958e-5 0.00022016683942638338 -9.593142749508843e-5 -8.043546404223889e-5 -4.349344635556918e-6 0.00010878795728785917; -3.396176907699555e-5 4.255436215316877e-5 -3.075001950492151e-5 6.066084824851714e-5 8.444184641120955e-5 4.993951733922586e-5 0.0001216066229972057 -0.00011140625429106876 7.343562901951373e-5 8.209136285586283e-5 -8.463180711260065e-5 0.00018464363529346883 6.530458631459624e-5 -4.368278314359486e-5 0.00011692281987052411 -2.900426807173062e-5 0.0001444336085114628 0.00011455071216914803 0.0001825230719987303 -4.0744751458987594e-5 -9.303181286668405e-6 0.00013156754721421748 3.34978467435576e-5 7.141782407416031e-5 0.00018720122170634568 -0.00011327971878927201 -0.00011806141992565244 -3.763917266041972e-5 0.00011102042481070384 -1.889719169412274e-5 -9.108316589845344e-5 5.948124817223288e-5; -2.086318636429496e-5 3.91930116165895e-5 0.00025514012668281794 -0.0002139571588486433 -2.30262025979755e-6 -5.335940295481123e-5 0.0002869916206691414 -1.8474496755516157e-5 3.875069523928687e-5 -1.4892323633830529e-5 1.5165760487434454e-5 -3.0925191822461784e-5 -6.531912367790937e-5 4.547715070657432e-5 0.00012131845141993836 6.530314067276777e-7 0.00019466527737677097 -4.455647285794839e-5 0.00011242242908338085 -9.649122512200847e-5 4.380339305498637e-5 4.849848664889578e-6 -5.150480137672275e-5 -5.352009247872047e-5 4.7421159251825884e-5 -1.5084576261870097e-5 -5.696310381608782e-6 8.164672181010246e-5 2.06838649319252e-5 -6.87397550791502e-5 -2.292862700414844e-5 3.265092891524546e-5; -5.06210963067133e-5 -6.590136763406917e-5 2.7295254767523147e-5 6.785587902413681e-5 -2.858049629139714e-5 -9.935642447089776e-5 1.1650772648863494e-5 7.711556099820882e-5 -9.584109648130834e-5 0.00012281221279408783 0.00011384339450160041 0.00010675919475033879 0.00012596943997777998 -5.3573512559523806e-5 -5.0661656132433563e-5 2.9598382752737962e-5 9.529483941150829e-5 -0.00015778090164531022 -5.36228071723599e-5 -9.790776675799862e-5 8.706811058800668e-5 -3.529195601004176e-5 -7.171274774009362e-5 -8.762481593294069e-5 -0.00011768707918236032 -7.68104218877852e-5 -9.935707794284099e-7 2.4225597371696495e-5 0.0001045654498739168 5.037926894146949e-5 -0.00013142326497472823 -9.494468395132571e-5; 0.00014995597302913666 9.986720397137105e-5 0.00010407927766209468 -1.625797085580416e-5 -8.046396396821365e-5 0.00012900421279482543 -6.693712202832103e-5 -4.135111885261722e-5 0.00011543834989424795 -0.00015414234076160938 -5.288960164762102e-5 -0.00014405786350835115 0.0001124829868786037 0.0001886830577859655 7.552094757556915e-5 0.00014891987666487694 3.222611849196255e-5 7.76816887082532e-5 6.148199463495985e-5 9.831896750256419e-5 8.423189683526289e-6 1.0490677595953457e-5 0.00016387861978728324 4.37204580521211e-5 0.00011128251207992435 -2.4865306841093116e-5 2.926977140305098e-5 0.00015343939594458789 -2.25813128054142e-5 1.3514246575141442e-6 -9.01991552382242e-6 5.79745028517209e-5; 0.00012908941425848752 0.00017004985420498997 -0.00018264981918036938 6.916146230651066e-5 -0.00011736273881979287 3.640523937065154e-5 3.554511204129085e-5 -4.313632871344453e-6 -0.00014152594667393714 0.00015956355491653085 -9.80846889433451e-5 -1.632304338272661e-5 0.00015479345165658742 0.00010319818102288991 0.00011270320828771219 8.313342550536618e-5 2.4202703571063466e-5 -3.1022998427943094e-6 -3.1354843486042228e-6 2.4498442144249566e-5 3.887103230226785e-5 0.00011755304149119183 -3.252447640988976e-5 5.899610187043436e-5 -0.00012047246127622202 6.8739336711587384e-6 4.889579213340767e-5 0.00017723218479659408 9.092457185033709e-5 -0.00025192511384375393 -0.0002048684109468013 0.00010372595716034994; -1.4538301911670715e-5 8.665032510180026e-5 -3.73125949408859e-5 4.692639777204022e-5 -3.4536529710749164e-5 6.460571603383869e-5 -7.22484037396498e-5 3.693340113386512e-5 8.066126611083746e-5 -0.00010153277253266424 4.073458694620058e-5 0.00010701360588427633 1.6191611393878702e-6 -0.00013487975229509175 -5.58849933440797e-5 2.027939262916334e-5 2.8286405722610652e-5 0.00012634843005798757 1.1813185665232595e-5 5.666584911523387e-5 -0.0001237436808878556 -4.7270576033042744e-5 5.6801789469318464e-5 -0.00022150481527205557 -1.6856605725479312e-5 -0.00010950070281978697 -0.00011607835767790675 4.440443080966361e-5 1.3667938219441567e-5 7.20061652828008e-5 -2.2913010980118997e-5 -0.00013765764015261084; 8.199760486604646e-5 -6.452525121858343e-5 8.80607112776488e-5 -2.1008481780881993e-5 3.2109968742588535e-5 6.655963807133958e-5 6.713056063745171e-5 -0.0001663284347159788 -0.00010709087655413896 -0.00023671681992709637 0.00012242849334143102 0.00010259175178362057 -1.745566441968549e-5 0.00019572730525396764 -4.877627725363709e-5 -5.6199478422058746e-5 8.792995913609047e-7 0.00022593802714254707 -0.00015920512669254094 0.00011337115574860945 0.00013078542542643845 -0.00011460031237220392 7.174606435000896e-5 3.7807007174706087e-5 4.3961943447357044e-5 -3.780126280616969e-5 3.4184613468823954e-5 8.801514923106879e-5 0.00016829275409691036 0.00012259601498953998 1.7522566849947907e-5 -4.758088107337244e-5; -7.614069909323007e-5 0.00023261112801264971 0.00010287864279234782 -5.2581512136384845e-5 -8.438424265477806e-5 -5.2203879022272304e-5 3.290802851552144e-5 -5.708840035367757e-5 -0.00014070482575334609 8.84660694282502e-5 1.3876808225177228e-5 4.8209687520284206e-5 -3.463959728833288e-5 5.00585010740906e-5 -8.674204582348466e-5 -9.211470751324669e-5 0.00017770176054909825 0.00017859437502920628 -6.680546448478708e-6 -3.1701823900220916e-5 -0.00010808530350914225 -0.0001667134783929214 -5.156878614798188e-5 3.394131999812089e-5 -4.682324288296513e-5 -0.00010998825746355578 9.351436165161431e-5 1.1708537385857198e-5 -3.887448110617697e-5 -7.375329005299136e-6 4.9114394641947e-5 0.00010338264110032469; 4.012147837784141e-5 0.00015258276835083961 6.675098848063499e-5 -3.585798549465835e-5 -0.00016114019672386348 -7.629751780768856e-5 2.518401913675916e-7 0.00010776079579954967 3.5758708690991625e-5 7.024879596428946e-5 -0.00021194509463384748 0.00015965144848451018 6.493335240520537e-5 0.00019593018805608153 3.804233710980043e-5 3.576635572244413e-5 0.00019816409621853381 -0.00017709667736198753 -0.00016501151549164206 -4.7592893679393455e-5 7.598539377795532e-5 -5.019588934374042e-5 -8.576433174312115e-5 -4.8806905397213995e-5 -0.00011829618597403169 0.00013327064516488463 -5.330101339495741e-5 -5.54084253963083e-5 -0.0001381394686177373 -3.07596055790782e-5 4.048054324812256e-5 0.00011269728565821424; 0.0001010134510579519 -0.00016902117931749672 -9.565131040289998e-5 -8.214934496209025e-5 -3.757493323064409e-5 1.100722420233069e-5 0.00012772750051226467 -9.62470585363917e-5 5.2399267588043585e-5 0.0002104196755681187 -8.78233477124013e-5 -3.6210258258506656e-5 0.00013236849918030202 2.143231176887639e-5 2.5981835278798826e-5 8.643748151371256e-5 6.99766872003238e-7 -3.883697445417056e-6 6.695327465422451e-5 2.1354382624849677e-5 -7.46220102882944e-5 1.0461862984811887e-5 0.00013906661479268223 -0.00010699549602577463 0.00017077039228752255 0.00010906219540629536 -0.0002313920558663085 -2.1057330741314217e-5 3.296437353128567e-5 4.412768976180814e-5 3.659077628981322e-5 7.634850044269115e-5; 5.106267053633928e-5 7.460081542376429e-5 -4.1127648728433996e-5 -0.00022245018044486642 -3.11892872559838e-5 5.0261791329830885e-5 -7.998225919436663e-5 4.421742778504267e-5 5.5362652346957475e-5 1.0165632602365804e-7 0.0002893582859542221 4.1623607103247195e-5 0.00011844484106404707 1.1187805739609757e-6 0.0001562212419230491 0.0001696163380984217 7.309682587219868e-6 -7.209839532151818e-5 9.984792268369347e-5 9.264392429031432e-5 0.00014144740998744965 6.883174501126632e-5 -0.00013373009278438985 7.690813617955428e-6 -0.00010866168304346502 -2.9126986191840842e-5 -7.808467489667237e-5 -0.00010527451377129182 8.609669748693705e-5 -0.00011646395432762802 4.882656503468752e-5 4.8688456445233896e-5; 4.694000745075755e-5 -0.00010401633335277438 6.231183942873031e-5 -4.5720325942966156e-6 7.633261702721938e-7 1.8675509636523202e-5 9.310727182310075e-5 -2.759424205578398e-5 -0.00010123413085239008 6.43162420601584e-5 7.895179442130029e-5 2.7124800908495672e-5 -4.9939684686250985e-5 -0.0001223723083967343 -0.000341716775437817 -0.0001288189523620531 4.313711906434037e-5 0.00011240263847867027 4.9043075705412775e-5 6.83585531078279e-5 -5.000780220143497e-5 7.324403122765943e-5 0.00013663565914612263 0.0001162666521850042 8.21512658149004e-5 -1.1502857887535356e-5 2.617876452859491e-5 -9.598058386472985e-5 8.190869266400114e-6 -2.360789403610397e-5 -9.036304254550487e-5 -6.080950333853252e-5; -1.3715957720705774e-5 -8.41051441966556e-5 5.94652010477148e-5 -1.955610241566319e-5 2.192511601606384e-5 -3.56439923052676e-5 -5.82466964260675e-5 -5.694152059732005e-5 -0.0001022093347273767 8.67952167027397e-6 7.639173418283463e-5 -1.5113198060134891e-5 -6.624032539548352e-5 -0.00018484400061424822 -9.45505962590687e-5 0.00011712846026057377 -2.078583747788798e-5 -6.758378731319681e-5 0.00010830098472069949 6.759551524737617e-6 -7.255279342643917e-5 -9.810127266973723e-6 -1.5961399185471237e-5 4.9568730901228264e-5 8.167483429133426e-6 -8.19488923298195e-5 0.00013709643098991364 2.5927041860995814e-5 9.240474901162088e-5 -3.420102075324394e-5 5.480751133291051e-5 4.968597204424441e-5; -0.00020982675778213888 3.755136640393175e-5 -0.0003176880127284676 2.41839970840374e-5 0.00011306101077934727 -6.092422336223535e-5 6.457806739490479e-5 -1.4142357031232677e-5 -0.00012810699990950525 -6.587410553038353e-6 9.308657899964601e-5 1.4210630979505368e-5 -2.3523436539107934e-5 7.286541949724779e-5 3.971675687353127e-5 6.266589480219409e-5 6.396984099410474e-5 -9.176765161100775e-5 -3.875304537359625e-5 -2.7184918508282863e-5 3.50439477188047e-5 2.858697007468436e-5 0.00011622824240475893 9.264493564842269e-5 5.1493167120497674e-5 -8.104584594548214e-6 7.390524842776358e-5 4.800327224074863e-5 -4.0212988096755e-5 -1.2165290854682098e-6 -9.684714314062148e-5 9.22318286029622e-5], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = [-0.00018670957069844007 -9.541074177832343e-6 -0.000138097966555506 -0.00011070806795032695 2.101217796735e-5 5.4213585826801136e-5 0.00010108544665854424 -1.2317656000959687e-5 -4.442619683686644e-5 -3.9467427995987236e-5 -0.00015926574997138232 0.00013600901002064347 3.4293927456019446e-5 -0.00012730815797112882 -0.00012411069474183023 -9.681236406322569e-6 3.5843007935909554e-5 1.7332102288492024e-5 -5.9415746363811195e-5 -8.296939631691203e-5 0.0001175716461148113 0.0002759793133009225 9.958855116565246e-6 4.810688551515341e-6 4.252554208505899e-5 -0.0001999368832912296 -2.6721078029368073e-5 -1.0287255463481415e-5 8.21089415694587e-5 -1.264777711185161e-5 4.3727824959205464e-5 0.00021627768001053482; -0.00019834791601169854 0.00013227728777565062 0.00010062654473586008 0.00010731467773439363 -0.00012726825661957264 5.8147059462498873e-5 -0.00012364305439405143 -0.00012802178389392793 0.00010511109576327726 5.542588041862473e-5 -0.0002078071265714243 0.00015936311683617532 -1.111684014176717e-5 -8.543636067770422e-5 4.742159217130393e-5 -1.0107236221301719e-6 0.00010073914745589718 -0.00020665898045990616 0.00013010262046009302 0.0001338869915343821 3.986773663200438e-5 -6.263764225877821e-5 7.322218880290166e-5 3.538677265169099e-5 -0.0002130083303200081 -3.9218986785272136e-5 -0.00010564343392616138 -1.9719871488632634e-5 6.923765613464639e-5 -7.617484516231343e-5 3.7278416129993275e-5 -0.00014633528189733624], bias = [0.0; 0.0;;]))
```


Now we define a system of odes which describes motion of point like particle with Newtonian physics, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function ODE_model(u, nn_params, t)
    χ, ϕ = u
    p, M, e = ode_model_params

    # In this example we know that `st` is am empty NamedTuple hence we can safely ignore
    # it, however, in general, we should use `st` to store the state of the neural network.
    y = 1 .+ first(nn([first(u)], nn_params, st))

    numer = (1 + e * cos(χ))^2
    denom = M * (p^(3 / 2))

    χ̇ = (numer / denom) * y[1]
    ϕ̇ = (numer / denom) * y[2]

    return [χ̇, ϕ̇]
end
```


```
ODE_model (generic function with 1 method)
```


Let us now simulate the neural network model and plot the results. We'll use the untrained neural network parameters to simulate the model.


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, params)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=params, saveat=tsteps, dt, adaptive=false))
waveform_nn = first(compute_waveform(dt_data, soln_nn, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2]],
        ["Waveform Data", "Waveform Neural Net (Untrained)"]; position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-35.png)


<a id='Setting-Up-for-Training-the-Neural-Network'></a>

## Setting Up for Training the Neural Network


Next, we define the objective (loss) function to be minimized when training the neural differential equations.


```julia
function loss(θ)
    pred = Array(solve(prob_nn, RK4(); u0, p=θ, saveat=tsteps, dt, adaptive=false))
    pred_waveform = first(compute_waveform(dt_data, pred, mass_ratio, ode_model_params))
    loss = sum(abs2, waveform .- pred_waveform)
    return loss, pred_waveform
end
```


```
loss (generic function with 1 method)
```


Warmup the loss function


```julia
loss(params)
```


```
(0.17603085235392915, [-0.024246974815258605, -0.023463194680594126, -0.022679414545929494, -0.021355078441783176, -0.019462477357629338, -0.016961387765063854, -0.013798994963334834, -0.009906927175885894, -0.005203514176566385, 0.0004065767107004626, 0.007023161269283504, 0.01472963389975712, 0.02354542616466329, 0.0332977030600021, 0.043343146445609416, 0.05190984071923181, 0.054704728972632184, 0.042642578200468816, 0.002180755349193615, -0.06604424337985179, -0.11020636433338982, -0.07647705659236016, -0.007191559479210195, 0.038480424318998334, 0.05405207683091123, 0.0528464341852986, 0.044834240204553656, 0.03488512141656337, 0.0250434593584863, 0.016074854643138018, 0.008199288678445733, 0.0014198295582978358, -0.004341066255815699, -0.009182052533142304, -0.01319952689888866, -0.016476276232841154, -0.019082818332690637, -0.02107426719403884, -0.02249245200833956, -0.023366766612856655, -0.02371511337493144, -0.023544231503786026, -0.02285092517895004, -0.021619769251533093, -0.01982511333174841, -0.017428765634248083, -0.014379164560571929, -0.010610751026386683, -0.006043092949106221, -0.0005822718979632448, 0.005871862117299092, 0.013410136808159397, 0.02206621617064082, 0.031713490780476514, 0.04181227764154767, 0.05083341500624426, 0.05500308076672981, 0.04610598001524789, 0.010783692920885291, -0.05506859557542549, -0.10806876123303562, -0.08603340006564719, -0.017253946117189903, 0.033571931592798115, 0.052999948000797284, 0.053618750542457336, 0.046275102852704655, 0.03647060881246608, 0.02655899787992843, 0.01744472464254972, 0.009400043165823187, 0.002458978757361083, -0.0034571824114507602, -0.008435222261852424, -0.012581176033971289, -0.015971930229823465, -0.01868689159882457, -0.02077664388474519, -0.02229028509733978, -0.023254834427306928, -0.023692510856644863, -0.023610552316166166, -0.02300645789142797, -0.02186823053099437, -0.020171686064808885, -0.017877310651013695, -0.014941254902576858, -0.011292804008671926, -0.006861254031280513, -0.0015459880808114774, 0.0047455492856553465, 0.012116383173796066, 0.020607235067467162, 0.030136961316286418, 0.040250450170750005, 0.049638491537836685, 0.05499127165652851, 0.04892520288072591, 0.018564182401473586, -0.04386126857493231, -0.10387640058125602, -0.09439722483796556, -0.027868692792265195, 0.027872856450858477, 0.05149779234938697, 0.05420016298624606, 0.047652980709391085, 0.03804836470314491, 0.028092213811133773, 0.018835292715823022, 0.01062978032507096, 0.003519005356628151, -0.002546362891247091, -0.007670281360219682, -0.011940181791403883, -0.015451978073839346, -0.01827145940036009, -0.02046452343781634, -0.0220711038011967, -0.02312839673021279, -0.023654568295706866, -0.023661183398900065, -0.023147545641114115, -0.022100665645537323, -0.020500837427898874, -0.018309037228216026, -0.015483430975953392, -0.011955307536303946, -0.007656284452071431, -0.002486499720716089, 0.0036455594509390205, 0.010847268522827783, 0.01917165679790888, 0.028569395853267086, 0.038667713543006015, 0.048344102161001365, 0.05470587227074646, 0.051159657369025724, 0.025496307086061886, -0.03269282871571616, -0.09780817411239695, -0.10125589656938637, -0.038865376569188544, 0.02135064394503579, 0.049496107179569114, 0.05455926901339491, 0.04895421793726081, 0.03961471534970204, 0.0296343671271585, 0.020253693335886738, 0.0118809911389462, 0.004607736438556353, -0.0016182975483189943, -0.006878010394970623, -0.011282403533873563, -0.014910955639247981, -0.01784248894336724, -0.02013263260164153, -0.02183769933764021, -0.022985997531577228, -0.02360181841516267, -0.023696921680002203, -0.023272555286618934, -0.022318165297400362, -0.020811418622163073, -0.018725429191842693, -0.016005966189603506, -0.012596594360112139, -0.00843016872093503, -0.0034045903502277074, 0.002572121786228388, 0.009605316103961769, 0.017757523757943733, 0.02701504851018453, 0.03707072307263314, 0.04696654759574781, 0.05418581038679094, 0.05286045025274338, 0.03159316956854431, -0.02181802924226194, -0.09009062329026284, -0.10634616035703764, -0.050030396032740884, 0.013997960929254023, 0.046933242459082695, 0.054666154358137875, 0.05016272032994775, 0.04115882349656398, 0.031192992084443406, 0.021688903876132426, 0.013158719917823516, 0.005717534964542005, -0.0006584730989533468, -0.0060696122941155135, -0.010603488658792067, -0.014353616222662213, -0.017390456356897604, -0.01978796847121121, -0.021587812438558823, -0.022828642680387125, -0.02353318999968078, -0.023717754796790787, -0.023382319136072166, -0.022518067135327547, -0.02111001326337632, -0.019120947607296147, -0.01651083125413954, -0.013218829340733606, -0.009181283190906974, -0.004297913449353668, 0.0015230579651363224, 0.008387834440375597, 0.016369344138201247, 0.025476521769972286, 0.03546488996424515, 0.045521659319914844, 0.05346052963435607, 0.054084482519479816, 0.036872948603900654, -0.011422807401631641, -0.08102100890776867, -0.10946414136885857, -0.06109427951800086, 0.005812022597365977, 0.04376222605135095, 0.0544804198216531, 0.051260617382045875, 0.042677327705436745, 0.032755006823265265, 0.023146791150112662, 0.014460824118533529, 0.0068545986251116395, 0.0003205452988712165, -0.00523707389206226, -0.009904023881052122, -0.013775845809517165, -0.016924063377653044, -0.01942498961227901, -0.021322024901442346, -0.022655594401291265, -0.02344991637410425, -0.02372321417781521, -0.02347678583338039, -0.022703513900986416, -0.021389761987755114, -0.019500522564085944, -0.016997220268317736, -0.013821258549772689, -0.00991093596099379, -0.006000613372214822])
```


Now let us define a callback function to store the loss over time


```julia
const losses = Float64[]

function callback(θ, l, pred_waveform)
    push!(losses, l)
    println("Training || Iteration: $(length(losses)) || Loss: $(l)")
    return false
end
```


```
callback (generic function with 1 method)
```


<a id='Training-the-Neural-Network'></a>

## Training the Neural Network


Training uses the BFGS optimizers. This seems to give good results because the Newtonian model seems to give a very good initial guess


```julia
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x, p) -> loss(x), adtype)
optprob = Optimization.OptimizationProblem(optf, params)
res = Optimization.solve(optprob,
    BFGS(; initial_stepnorm=0.01, linesearch=LineSearches.BackTracking());
    callback, maxiters=1000)
```


```
u: ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [0.00016324222087837258; -9.119624155562424e-5; -0.00013215918443154398; 0.00017176564142569665; -4.567572977974539e-5; 2.1612162527124062e-5; -6.553751518358009e-6; 0.00023585004964864705; 2.84410958783711e-7; 1.0365963134978448e-5; -0.0001239350676769918; 0.0002394710172665577; -0.00012061464076380673; 4.614720455712812e-5; 4.760712783982287e-7; -0.0001271632791030013; 0.00013870673137700063; -9.800489351614707e-6; 6.632507574968844e-5; -7.466532406389439e-5; 0.00018069166981125203; -4.4364925997759256e-5; 0.00010991306044141604; -0.0002132838126269949; -1.282322318727842e-5; -0.0001451019925298965; -4.663298511789489e-7; 5.460931060946189e-5; -8.374820936291719e-6; -4.4428867113324105e-5; 0.00011257101141389193; -0.00010540305811434626;;], bias = [2.60400340708653e-16; -1.2401662877406337e-16; -1.294000846540504e-16; 4.6770117813814135e-17; -1.708558391141082e-17; 4.358118326167854e-17; -1.107026254427285e-17; -2.405225043009272e-16; 3.984257480249257e-19; -6.482476309588458e-18; 5.923861480945891e-17; 8.081509669482188e-17; -1.7467650074401106e-16; 8.2879855277523e-17; 9.850357404161828e-19; -1.2726126292490256e-16; 1.9027547483710884e-16; -4.9891832897685325e-18; 9.50814619581845e-17; -8.69874673857256e-17; 2.7695189917077066e-16; -4.197654707540374e-17; 2.2258090213456156e-16; -2.2251562773535277e-16; -2.118305006300397e-17; 8.932324676550764e-17; 3.1557297492433075e-19; 6.734760659400379e-17; -5.486720446430291e-18; 1.474885128677303e-17; -8.079182992910413e-17; -1.3037535164765934e-16;;]), layer_3 = (weight = [2.0350967966970592e-5 3.1093519206634374e-5 -0.00014691005534025317 -7.149994970297243e-5 -0.0001826906683016501 -2.3950888897465918e-6 8.746208724566375e-5 -0.00015281010026574479 -8.51811917876489e-6 0.00011550461014500463 7.36045141472895e-6 -0.00019961333790324885 -2.315650461589545e-5 -4.915117286494257e-5 -0.00010986661989939762 1.7141186541425885e-5 -1.250532485193894e-5 8.783639888512544e-5 2.273707824876392e-5 6.143937745598063e-5 -0.00014374393693634887 3.59273489413384e-5 0.00010180569180754261 0.00010308712618661186 -9.805061025311594e-5 -0.00011801654371431325 7.510585957440184e-5 5.924071403221016e-5 9.359252536902776e-5 6.0818709167658516e-5 -1.4457347864505851e-5 -5.296078787416953e-5; 0.00023917729020678566 0.00014267044360377398 8.941222115311195e-6 -0.0002504161933008467 5.946452409471698e-5 2.7344947450098412e-5 0.00011233205048693593 2.1749112131442757e-5 -6.22323462427569e-5 -3.672270060423511e-5 0.0001179898569556025 -0.00011356770511854307 -1.72719103990752e-5 1.3273353654137684e-5 1.821162157494357e-5 -6.565988980372624e-5 1.9349377618994526e-5 -7.66413325597507e-5 3.570573579264255e-5 -0.0002773107810914475 -2.5291523632115355e-5 -5.662251003461837e-6 0.0001227256467994364 -0.0001541272907322109 3.34797875278189e-5 7.245159548102838e-5 -0.00010555106229521087 7.278159653861414e-5 1.995259634196077e-5 -0.00012694766002613745 -6.961647551878652e-5 8.189371039689335e-6; -5.4563787455774983e-5 -0.00010275692217247924 1.118924704940708e-5 3.1536759012738766e-5 0.00013472068643467398 7.294231397180926e-6 2.818356300566793e-5 6.802444953506332e-5 2.1318355026678017e-5 -4.200558647708988e-5 -1.4413044601657431e-6 6.41231610978712e-5 -9.262865820630148e-5 5.896764308716997e-5 3.3046574787376287e-5 0.00010347415194417589 -1.6721658204182218e-6 -0.00015603405951252226 8.753917176080667e-5 -8.610317924022924e-5 5.4314977421085504e-5 3.0448705035167692e-5 5.2929398622731125e-5 -2.0207579621575408e-5 -8.343691912442469e-5 -2.1026826983070594e-5 -1.4782262736035209e-5 9.997539131007946e-5 6.814060292243939e-5 -1.5021384354542072e-5 1.9282860409369812e-5 5.36396703290705e-5; -5.195951343965436e-5 3.9644971183872514e-5 9.430016398211088e-5 -7.7187892384684e-5 4.283293928848322e-5 -6.996777046923818e-5 2.9978186648359308e-5 1.9195364802293308e-5 1.9925245214390344e-5 5.242784645771308e-5 -0.00010184533421169002 4.75286931755582e-5 1.5024193816783534e-5 6.540410577100446e-5 -0.00020942699593478185 -6.859073782705619e-7 3.094621824813194e-5 -0.0001907573107023288 -1.1902801089025763e-5 6.830080382780233e-6 0.00014557423746693358 3.563998579876237e-5 -0.0001443772282077469 -0.00013581003549959753 -8.678655104167487e-6 0.00018253584021250875 -4.716544681331445e-5 1.2907043855658226e-5 -0.00010345854498199489 -6.222167685381395e-5 5.6273997688106936e-5 0.00014317547065685442; 0.0001525545407584485 -1.8534576671358475e-5 -0.00014479428915916404 2.793766128337922e-5 -8.786737868473806e-5 -0.00011688234787113025 0.0001373294975873548 0.00024093840641758267 2.935485266728143e-6 -6.986676141065548e-5 1.0804656480047908e-5 8.411219044678761e-5 -8.482880054185655e-5 -0.0002188569747577881 -7.788442286807121e-5 5.989174991003734e-5 -0.00010408691429443995 2.960445038655303e-5 0.0001364190279072629 0.00019910250869901083 -5.690667291315193e-5 6.655171040068436e-5 -6.96057655350734e-5 0.0001354825539546694 -0.00025750815672478635 0.00014430057802559523 -0.00015376154312076986 -1.942918121191045e-6 -9.803278377209834e-6 -9.475180246778709e-5 -9.14999660072344e-5 -1.2096259130033533e-5; -0.00013393168635934637 -1.929539152979347e-7 2.6419014393698214e-5 -3.9693159560329475e-5 -7.230419439997004e-5 -2.5558456836500217e-5 -5.4379156135603696e-5 2.1527171629934852e-5 2.6461314992281705e-5 1.9300555507080398e-6 0.00022817975834209684 -0.0001521717990542651 5.828436907927737e-5 0.00018682720248785388 -3.414145838154843e-5 0.00013401440221082612 -2.0039179143848524e-5 -3.069953752832852e-5 -9.759906832163688e-5 -4.9389973791898495e-5 7.579742807160878e-5 -0.00021069951479125247 0.00020208837806444906 2.0090413745716042e-5 0.00014770551344577785 -0.0001539759891600153 0.00012176753945846678 8.447252323117606e-5 -2.771871229901343e-5 -0.00015391900385997668 7.742615845950593e-5 2.433210967888436e-5; 0.0001002051689265268 4.7399131652099566e-5 0.000127753938066209 -6.637874648915804e-5 5.443100999215584e-5 4.790566563130278e-5 -0.00018613618485872728 3.905228040637981e-5 -1.6776669874192198e-5 8.714812101785939e-5 -9.83104710215132e-6 -3.585578779349455e-5 -1.6168305230193417e-5 7.200925428875692e-5 -0.0001344188527600942 -0.0003133509777417464 -1.6459401742420353e-5 -0.00013445072145444432 -7.766925737271985e-5 4.3728869421072956e-5 0.00010826022153012343 -9.397162975986523e-5 -0.00012386768103354363 1.785342865148807e-5 5.221746723506513e-5 -3.371044622511107e-5 -3.11781037471825e-5 5.6115281402496534e-5 0.00020380915920938274 1.77526675524559e-5 2.20724964307942e-6 -3.869098784007503e-6; 0.0003185759974155139 0.00014498794688616736 -3.2767230105762535e-5 0.00012887999536241476 7.420417886234228e-5 -8.385293996187394e-5 -5.937190736520537e-5 9.415094745115284e-5 0.00010427677397157563 0.00010234960563022202 -2.0510619389184214e-5 1.1396390153702886e-5 2.156900471955375e-5 1.826333162963726e-5 -7.274161372409084e-6 -2.2815254499588413e-6 4.119614958535818e-5 -5.23130570502716e-5 0.00011419379506034006 -0.0001022810415736672 -4.2296951970739146e-5 -5.739508061313655e-5 0.0001214238850377177 3.0568214594298804e-6 -5.365168409415031e-5 3.0334005249368795e-5 -5.9571493796127595e-6 -0.0001197417318610727 6.49504922773459e-5 -3.891360621426839e-5 -7.906695328646823e-5 -2.611048922635045e-5; -0.00011720784577924039 -0.00026418376846857017 -0.0001897519444363418 -0.00016578138938789122 -4.2769868749781896e-6 -0.00010214811964113871 -9.301399159165756e-5 4.106564911052171e-5 3.9773107982103606e-5 5.4633047238088234e-5 5.1078920204539745e-5 0.00013421558351109532 -5.221504516236308e-5 4.002928353576517e-5 -4.128742266483336e-5 0.00016483282770344434 1.5468360924514025e-5 0.00020359669970195095 -5.066977364629635e-5 -0.00014083422620467823 -2.5313054084875128e-5 -8.473819371000355e-5 -0.00023900068963564127 -0.00014496977864912497 9.617983841882376e-5 6.957635559175761e-6 -1.0952514731695051e-5 -3.981094532799275e-5 7.807387827700447e-6 2.0659087559724807e-6 6.781188130053402e-6 -6.479043559090477e-5; -7.328299679278219e-5 -2.6172675545203554e-5 -7.498871408820162e-5 -9.284250253761592e-5 -4.378733782866059e-5 -0.00013029660030221783 -0.00023083019467955724 -3.196137831027634e-5 -8.837635240704096e-5 -3.5500895221021766e-5 -2.3570221939690272e-5 2.0367681743760677e-5 0.00011815716871574159 7.711852677678676e-5 -5.393209532458977e-6 -7.146438573904503e-5 -5.8332922973882195e-5 -0.00010129677238362173 -6.740763919148331e-5 -5.210499065648358e-5 -0.00010112302979171296 5.590793526428717e-5 -9.161426996065967e-5 -0.00013291421336535686 -9.316622444382192e-5 0.0001131818325193828 0.00022049825648357818 -3.191958884778342e-5 -3.8760429644727004e-5 -5.737246382702176e-5 0.00017918362292043268 4.246692158670952e-6; 2.9614624547547788e-5 1.0533957758753083e-5 -7.841437725574183e-6 1.942007296952326e-5 -4.390221325388617e-5 2.666649565276258e-5 -8.385303733802514e-6 1.1330139425124774e-5 0.0001287635405262796 -3.654668212925514e-5 -7.36222269347318e-6 5.035053440428592e-5 -4.4501071859258506e-5 -3.030605144681383e-5 5.863669723340199e-6 0.00016774851432478484 -2.0875055231727208e-5 -0.00015588274796550592 -7.831895159847553e-5 -5.964942643709005e-5 0.00011243852535903813 7.091577758024009e-5 -3.1659053963949143e-5 -1.2173344619215226e-5 -0.00010518757149634384 0.000115520955698457 5.9643362349112335e-6 -0.0001625199492607403 6.635202047823497e-5 1.1558609951180674e-5 9.641128603311701e-5 -8.963137039040694e-5; -8.1740740348944e-5 -0.00020712306875492016 -8.375198238052939e-5 0.00010507030813034108 5.1923508657016434e-5 -3.789870468306855e-5 8.611502700961625e-5 -0.0001708406621007115 -8.51921563268503e-5 -0.0001445173388462377 7.997812055993316e-5 -3.87397253477347e-5 0.00010452799462956798 -0.00010135419731949026 9.411167550144216e-5 0.0001295890411013873 4.4220637867799514e-5 7.588430300831293e-5 5.711549740528185e-5 1.745073452486154e-5 -5.1021388112809564e-8 0.0001288674261771279 5.578303673548117e-5 2.94697688544303e-5 -1.2666587714813995e-5 -5.5075898195975926e-5 -0.0001287809995816884 3.32559843839748e-5 2.9740976536520413e-5 9.22016274883548e-5 -7.300680452015759e-5 9.478686045729154e-6; 0.00019889035735745424 -0.00013380593321287216 0.00014300308663863377 -0.00014150586087721657 -3.419724765351694e-5 -6.772225918482844e-5 -4.9785583026259045e-5 8.206045874164477e-5 5.92893453058611e-5 9.268513946792225e-5 3.951833211462707e-6 -0.00014560174480077631 -2.698723204318059e-5 -0.00012783988079989041 0.00012094303071264283 -2.178647030902051e-5 6.517005073604933e-5 -9.855001138292139e-5 -5.1958780598374974e-5 -0.00010727060310543881 -7.179099651052609e-5 -0.00018488629887813428 6.887587784788743e-5 7.039744793206587e-5 -0.00015944655336441353 6.516372792888413e-5 -3.578771014233945e-5 -1.8706195472056246e-5 2.1697826529835543e-5 -0.000136516314735652 -0.00010974436321063678 8.55808726255698e-5; 0.0002358865865750817 -6.622643124892615e-5 1.4676244769084534e-5 0.00019011959082098799 6.132056730684757e-5 1.5263320870599462e-5 5.636085622945787e-5 -6.675886399927206e-5 -2.5148706503659602e-5 -5.3666665939362876e-5 -4.62329837540021e-5 -5.838853871243133e-6 0.00015805309228716943 0.00014200286821114763 -5.183522009638151e-5 2.8779969193870352e-5 -5.341980724943404e-5 -5.796799745712345e-6 0.00013828380613240283 -1.662165889165528e-5 1.321735069331282e-5 -0.0001715164864656801 7.059688212002286e-5 -3.500077148083911e-5 -7.174592903929779e-5 3.6703514320555834e-5 1.071859039775549e-5 5.1138508548046465e-5 -0.00017994686206684464 -0.00010098803907048954 -5.152192463747581e-5 -4.420003028192662e-6; 6.947463747676947e-5 9.348491197781328e-5 -8.496314354376782e-5 0.00010041340623614054 0.0001915470090727636 -0.00014016990849884882 7.116260871154514e-5 0.00010619106955459223 -8.289258790571918e-5 1.4588825854094442e-6 5.056129103854701e-6 -0.00016898348645441274 -0.00014861460318459237 4.810981385273279e-5 -5.1742066951903725e-5 -7.600451192726916e-7 -0.00014827539804061714 -2.5761492232761532e-5 6.872518473866843e-5 -2.0113773879329334e-5 2.2993051735496155e-5 8.618770129143602e-5 -0.00012240213642032962 0.0001317254534489978 2.8642336238788285e-5 0.00010115447707105669 1.0457328008867577e-5 -9.975194212418596e-5 9.868589351042446e-6 -1.9235458474924154e-5 -0.00015728483800446738 -0.0002243312012604084; -1.3582137643708456e-5 -7.585435675475014e-5 4.988593057595229e-5 -5.177802383451377e-5 -0.00011125461175590182 -1.154590997368268e-5 3.6756828018777794e-6 1.0122612457885191e-7 -0.00012976611039386548 -9.119843459240575e-5 2.1449380011004205e-5 -8.364691463548555e-5 -1.1652794700526102e-5 4.405923146515739e-6 -6.38998856350728e-5 -9.203678263761082e-6 -2.5938615426015228e-5 6.508656654721643e-5 0.00016330217179591467 2.9098483292439104e-5 -0.00017476397922046985 -5.736904792622096e-5 -9.377830128247025e-6 -7.750703231914144e-5 0.00017532547347462324 -9.170313139230815e-5 0.00016063109499617063 -1.2014581688452633e-5 4.386720530129328e-6 5.671552274241679e-5 8.348137337696651e-5 8.118013350275217e-5; -2.7538501026270232e-5 6.399778786551735e-5 3.218831617240206e-5 0.0001983779219791333 4.8496683948608325e-5 -2.1430214555883957e-5 -2.3547860191619543e-5 -2.2271924617488796e-5 -0.0001359524468079411 -3.685813143413654e-5 6.515745181794451e-5 6.487150958602865e-6 1.526175939041761e-5 6.1003203800348815e-5 -0.00013642846905889143 -3.83317202157876e-5 -0.00015849327618517423 0.00016261068222781503 -6.150163252634718e-5 3.510761954210073e-5 -4.06759500855515e-5 -0.00017285106886440874 -5.8241643355284845e-5 -8.216941941090093e-5 -9.974155554112182e-5 -0.00013459516057074363 -9.918602162536381e-5 3.0520683686275866e-6 -4.0911156329392955e-5 -3.583724182128894e-5 5.72880780146825e-5 3.7139379774162664e-5; 6.387866257896663e-5 -0.00015594750923595248 5.6417677362659796e-5 -0.00015538063937824367 0.00013563753989034825 0.0001558065526045266 7.533086706859673e-5 5.384179191636135e-5 0.00010139454777560813 -5.7881515865692344e-5 -6.105428085687836e-5 -4.322119573467658e-6 0.00012506384179902043 -4.7590354122467986e-5 -4.784105088004225e-5 -9.069353448252507e-5 -4.473356578059052e-5 0.00011350450610950267 -3.4640811260328343e-6 0.00020263167632253204 3.700111508110209e-5 -3.0720147813218267e-5 -7.7336440633769e-5 -0.00014215530584593436 5.898108817961675e-5 -4.63462235781144e-5 8.654627551765797e-5 0.00022016861136978005 -9.592965555169009e-5 -8.043369209884162e-5 -4.3475726921658035e-6 0.00010878972923125118; -3.3957365075770586e-5 4.255876615442031e-5 -3.074561550368322e-5 6.066525224973797e-5 8.444625041247011e-5 4.994392134048879e-5 0.00012161102699846927 -0.00011140185028988582 7.344003302077736e-5 8.20957668571263e-5 -8.462740311135932e-5 0.0001846480392946493 6.530899031583877e-5 -4.367837914233434e-5 0.00011692722387178774 -2.8999864070490456e-5 0.0001444380125126985 0.00011455511617041152 0.0001825274759999875 -4.074034745773206e-5 -9.29877728545214e-6 0.00013157195121547824 3.35022507448037e-5 7.142222807535794e-5 0.00018720562570760904 -0.00011327531478803893 -0.00011805701592438881 -3.763476865916043e-5 0.00011102482881196738 -1.889278769286199e-5 -9.107876189720822e-5 5.948565217348038e-5; -2.0861051997384174e-5 3.91951459835132e-5 0.0002551422610497353 -0.00021395502448173453 -2.3004858928694784e-6 -5.3357268587882015e-5 0.0002869937550360709 -1.8472362388625756e-5 3.875282960621642e-5 -1.4890189266901068e-5 1.5167894854353183e-5 -3.092305745557259e-5 -6.531698931099006e-5 4.547928507350235e-5 0.00012132058578686788 6.551657736458388e-7 0.00019466741174368695 -4.455433849101892e-5 0.00011242456345030728 -9.648909075508286e-5 4.3805527421892935e-5 4.851983031817732e-6 -5.1502667009801723e-5 -5.3517958111822935e-5 4.7423293618755316e-5 -1.5082441894955373e-5 -5.6941760146792426e-6 8.164885617702988e-5 2.068599929885469e-5 -6.873762071222206e-5 -2.2926492637227816e-5 3.265306328216717e-5; -5.0622386056893346e-5 -6.59026573842569e-5 2.729396501733924e-5 6.785458927395796e-5 -2.8581786041587498e-5 -9.935771422108881e-5 1.1649482898672277e-5 7.711427124804095e-5 -9.584238623149958e-5 0.0001228109230438966 0.00011384210475141564 0.00010675790500017165 0.00012596815022759486 -5.357480230971416e-5 -5.0662945882624806e-5 2.9597093002553515e-5 9.529354966132515e-5 -0.00015778219139550147 -5.36240969225493e-5 -9.790905650818751e-5 8.706682083782917e-5 -3.529324576023218e-5 -7.171403749027979e-5 -8.762610568311283e-5 -0.00011768836893255149 -7.68117116379676e-5 -9.94860529619648e-7 2.4224307621506515e-5 0.0001045641601237256 5.037797919127907e-5 -0.00013142455472491414 -9.494597370151228e-5; 0.0001499615414445005 9.987277238676782e-5 0.00010408484607747505 -1.6252402440445426e-5 -8.045839555280567e-5 0.00012900978121023628 -6.69315536129094e-5 -4.1345550437305366e-5 0.00011544391830965965 -0.0001541367723461979 -5.2884033232236885e-5 -0.00014405229509304232 0.00011248855529398931 0.00018868862620137337 7.552651599098085e-5 0.00014892544508025962 3.223168690733972e-5 7.768725712366476e-5 6.148756305036367e-5 9.832453591796589e-5 8.428758098879382e-6 1.0496246011361638e-5 0.00016388418820267327 4.3726026467451136e-5 0.00011128808049533576 -2.485973842571921e-5 2.927533981846269e-5 0.00015344496435999423 -2.2575744390002614e-5 1.356993072922312e-6 -9.014347108433461e-6 5.7980071267112665e-5; 0.00012909161973133996 0.00017005205967785567 -0.00018264761370751027 6.916366777936102e-5 -0.00011736053334692264 3.6407444843522904e-5 3.554731751416251e-5 -4.311427398512938e-6 -0.00014152374120106543 0.00015956576038940245 -9.808248347048447e-5 -1.632083790989634e-5 0.00015479565712944865 0.0001032003864957601 0.0001127054137605839 8.313563097822621e-5 2.4204909043921268e-5 -3.100094369922676e-6 -3.1332788757356975e-6 2.4500647617117244e-5 3.887323777511596e-5 0.00011755524696406214 -3.2522270937026786e-5 5.899830734327319e-5 -0.00012047025580335043 6.87613914401523e-6 4.889799760627936e-5 0.00017723439026946363 9.092677732320875e-5 -0.00025192290837088363 -0.00020486620547393875 0.00010372816263321361; -1.4539664250564806e-5 8.664896276289801e-5 -3.731395727978409e-5 4.692503543314739e-5 -3.45378920496542e-5 6.46043536949329e-5 -7.224976607855577e-5 3.693203879498394e-5 8.065990377193148e-5 -0.00010153413487157018 4.073322460730145e-5 0.00010701224354539591 1.6177988004883832e-6 -0.00013488111463399676 -5.5886355682985675e-5 2.027803029026457e-5 2.828504338371326e-5 0.0001263470677190817 1.1811823326328586e-5 5.666448677633038e-5 -0.000123745043226747 -4.7271938371947835e-5 5.680042713041788e-5 -0.00022150617761094126 -1.6857968064385217e-5 -0.00010950206515868355 -0.00011607972001681273 4.440306847075896e-5 1.3666575880535623e-5 7.20048029438957e-5 -2.2914373319019325e-5 -0.00013765900249151187; 8.200051862401151e-5 -6.452233746060107e-5 8.806362503562249e-5 -2.100556802291964e-5 3.211288250057676e-5 6.656255182932933e-5 6.713347439544187e-5 -0.0001663255209580411 -0.00010708796279614877 -0.00023671390616910627 0.00012243140709940675 0.00010259466554155664 -1.7452750661709023e-5 0.00019573021901195584 -4.877336349564688e-5 -5.619656466408381e-5 8.822133493329478e-7 0.00022594094090053717 -0.0001592022129345549 0.0001133740695065944 0.0001307883391843978 -0.00011459739861421557 7.174897810798777e-5 3.780992093265336e-5 4.396485720534709e-5 -3.779834904819937e-5 3.4187527226814164e-5 8.801806298905619e-5 0.00016829566785490048 0.00012259892874752831 1.752548060792615e-5 -4.757796731539272e-5; -7.614080222965347e-5 0.00023261102487622567 0.00010287853965592411 -5.258161527280816e-5 -8.438434579120231e-5 -5.220398215869661e-5 3.2907925379097116e-5 -5.708850349009999e-5 -0.00014070492888977043 8.84659662918259e-5 1.3876705088753433e-5 4.820958438386185e-5 -3.46397004247567e-5 5.005839793766635e-5 -8.674214895990896e-5 -9.211481064967043e-5 0.0001777016574126746 0.0001785942718927819 -6.680649584902875e-6 -3.1701927036645054e-5 -0.00010808540664556544 -0.00016671358152934568 -5.156888928440579e-5 3.394121686169812e-5 -4.6823346019389453e-5 -0.00010998836059997938 9.351425851519001e-5 1.1708434249432983e-5 -3.887458424260129e-5 -7.375432141723386e-6 4.911429150552312e-5 0.00010338253796390076; 4.01217617618021e-5 0.00015258305173480196 6.675127186459651e-5 -3.5857702110697936e-5 -0.00016113991333990054 -7.629723442372549e-5 2.521235753307278e-7 0.00010776107918350768 3.575899207495475e-5 7.024907934825258e-5 -0.00021194481124988578 0.00015965173186846803 6.493363578916716e-5 0.00019593047144004448 3.8042620493763554e-5 3.576663910640579e-5 0.00019816437960249513 -0.00017709639397802437 -0.00016501123210767933 -4.7592610295430824e-5 7.598567716191545e-5 -5.019560595977746e-5 -8.576404835915913e-5 -4.880662201325506e-5 -0.00011829590259006857 0.00013327092854884578 -5.330073001099428e-5 -5.5408142012345435e-5 -0.00013813918523377413 -3.075932219511524e-5 4.0480826632084525e-5 0.00011269756904217636; 0.00010101513883969493 -0.00016901949153574352 -9.564962262115187e-5 -8.21476571803488e-5 -3.757324544888751e-5 1.1008911984088166e-5 0.0001277291882940224 -9.624537075466466e-5 5.2400955369801316e-5 0.0002104213633498764 -8.782165993065203e-5 -3.6208570476780564e-5 0.00013237018696205172 2.1433999550632943e-5 2.598352306055656e-5 8.643916929546137e-5 7.014546537503581e-7 -3.882009663659376e-6 6.695496243597984e-5 2.1356070406604338e-5 -7.462032250655468e-5 1.0463550766568533e-5 0.00013906830257443329 -0.00010699380824404198 0.00017077208006928022 0.00010906388318804147 -0.00023139036808455076 -2.1055642959558127e-5 3.296606131304336e-5 4.4129377543564795e-5 3.659246407156396e-5 7.635018822444275e-5; 5.106516418480613e-5 7.460330907224609e-5 -4.112515507995967e-5 -0.0002224476867964019 -3.118679360749695e-5 5.026428497831904e-5 -7.997976554587813e-5 4.421992143348595e-5 5.536514599544602e-5 1.041499745121191e-7 0.00028936077960269805 4.1626100751689046e-5 0.00011844733471252377 1.1212742224477908e-6 0.00015622373557153764 0.00016961883174689707 7.312176235692751e-6 -7.209590167302973e-5 9.985041633217842e-5 9.264641793879832e-5 0.00014144990363591163 6.883423865975328e-5 -0.00013372759913591112 7.693307266406938e-6 -0.00010865918939497661 -2.9124492543369434e-5 -7.808218124818384e-5 -0.00010527202012280569 8.609919113542552e-5 -0.00011646146067914106 4.882905868316575e-5 4.8690950093713396e-5; 4.693959939226703e-5 -0.00010401674141126736 6.231143137023855e-5 -4.572440652786761e-6 7.629181117783989e-7 1.867510157802919e-5 9.310686376460669e-5 -2.7594650114270655e-5 -0.00010123453891088414 6.431583400166436e-5 7.895138636280825e-5 2.712439285000923e-5 -4.994009274474312e-5 -0.00012237271645522806 -0.00034171718349631104 -0.000128819360420545 4.313671100584886e-5 0.00011240223042017622 4.904266764691929e-5 6.835814504933458e-5 -5.00082102599247e-5 7.32436231691656e-5 0.00013663525108763018 0.00011626624412651619 8.215085775640635e-5 -1.1503265946026626e-5 2.617835647010084e-5 -9.598099192322353e-5 8.190461207906054e-6 -2.3608302094597782e-5 -9.036345060399726e-5 -6.080991139702512e-5; -1.371680833052488e-5 -8.410599480647978e-5 5.9464350437893146e-5 -1.9556953025481503e-5 2.1924265406237907e-5 -3.564484291509398e-5 -5.8247547035893986e-5 -5.694237120713111e-5 -0.00010221018533720323 8.678671060447493e-6 7.63908835730124e-5 -1.5114048669945466e-5 -6.624117600530597e-5 -0.0001848448512240741 -9.455144686889522e-5 0.00011712760965075176 -2.078668808770914e-5 -6.75846379230233e-5 0.0001083001341108742 6.758700914912656e-6 -7.25536440362566e-5 -9.810977876799684e-6 -1.5962249795294388e-5 4.95678802914144e-5 8.166632819306962e-6 -8.194974293964017e-5 0.00013709558038008714 2.5926191251170132e-5 9.240389840179438e-5 -3.4201871363069894e-5 5.480666072308751e-5 4.968512143442098e-5; -0.0002098265170232281 3.755160716284395e-5 -0.0003176877719695561 2.418423784294795e-5 0.00011306125153825994 -6.092398260332254e-5 6.457830815381761e-5 -1.4142116272324154e-5 -0.0001281067591505924 -6.587169794125522e-6 9.308681975855765e-5 1.4210871738413757e-5 -2.3523195780196222e-5 7.286566025616046e-5 3.971699763244412e-5 6.266613556110568e-5 6.39700817530161e-5 -9.176741085209493e-5 -3.875280461468374e-5 -2.7184677749370456e-5 3.5044188477715015e-5 2.8587210833597043e-5 0.00011622848316367083 9.264517640733201e-5 5.1493407879410514e-5 -8.104343835637009e-6 7.39054891866764e-5 4.8003512999661245e-5 -4.021274733784215e-5 -1.2162883265555237e-6 -9.684690238170963e-5 9.223206936187416e-5], bias = [-1.5443982499598983e-9; -9.279735361563176e-10; 1.2671415692417525e-9; -6.632039819331299e-10; -9.573032614516877e-10; 7.071505543794228e-10; -8.6183902898845e-10; 2.3842300990384197e-9; -3.701007596325388e-9; -3.7135505144850683e-9; 1.3282465318168413e-10; 1.593736431519116e-11; -2.5278795686143225e-9; 8.265266845642595e-10; -1.3208216682450195e-9; -7.887768507556485e-10; -2.4884592942859092e-9; 1.771943398397311e-9; 4.404001263610585e-9; 2.134366929539561e-9; -1.289750191238248e-9; 5.568415411712193e-9; 2.2054728717031723e-9; -1.3623389059724938e-9; 2.9137579902010438e-9; -1.0313642431694866e-10; 2.83383963140138e-10; 1.6877817577326577e-9; 2.4936484885485644e-9; -4.080584940726718e-10; -8.506098265086323e-10; 2.4075891283955016e-10;;]), layer_4 = (weight = [-0.0008755086745425199 -0.0006983402147303776 -0.0008268970881467801 -0.0007995072179653374 -0.0006677869622037866 -0.0006345855635003969 -0.000587713697833341 -0.000701116688373588 -0.0007332250355734139 -0.0007282662671609274 -0.0008480649101609804 -0.0005527901505785143 -0.000654505089267235 -0.0008161073024330406 -0.0008129098134623402 -0.0006984803827644732 -0.0006529560113523858 -0.00067146698890384 -0.00074821444727465 -0.0007717684479706841 -0.0005712274778826508 -0.0004128192089831741 -0.0006788401938458158 -0.0006839884295791525 -0.0006462734326147265 -0.0008887360436363827 -0.0007155202368082551 -0.000699086350978967 -0.0006066900799770908 -0.0007014469339355978 -0.0006450713193101855 -0.0004725214793887783; 4.59546941018377e-5 0.0003765799108548145 0.000344929161117364 0.0003516173041572054 0.00011703436632485842 0.0003024496856417214 0.00012065957007654027 0.0001162808009646303 0.0003494136122088367 0.0002997283970156951 3.649550344594287e-5 0.0004036657469982173 0.0002331857391847377 0.00015886626378351212 0.0002917242075385371 0.0002432919015083522 0.0003450417276879417 3.7643625179673816e-5 0.0003744050882126271 0.0003781895832064838 0.00028417035386049135 0.00018166476231729642 0.00031752477952092607 0.00027968938780871804 3.129423415950531e-5 0.00020508364328704738 0.0001386591955927705 0.00022458273567846167 0.000313540237162628 0.00016812778366583945 0.0002815810405221731 9.796734784070536e-5], bias = [-0.0006887991606047958; 0.0002443026301640397;;]))
```


<a id='Visualizing-the-Results'></a>

## Visualizing the Results


Let us now plot the loss over time


```julia
fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Iteration", ylabel="Loss")

    lines!(ax, losses; linewidth=2, alpha=0.75)

    return fig
end
```


![](1_GravitationalWaveForm-48.png)


Finally let us visualize the results


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, res.u)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=res.u, saveat=tsteps, dt, adaptive=false))
waveform_nn_trained = first(compute_waveform(dt_data, soln_nn, mass_ratio,
    ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l3 = lines!(ax, tsteps, waveform_nn_trained; linewidth=2, alpha=0.75)
    s3 = scatter!(ax, tsteps, waveform_nn_trained; markershape=:circle, markeralpha=0.25,
        alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2], [l3, s3]],
        ["Waveform Data", "Waveform Neural Net (Untrained)", "Waveform Neural Net"];
        position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-50.png)


---


*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

